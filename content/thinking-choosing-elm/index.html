<!DOCTYPE html><html><head><title>Thinking (And Choosing) Elm</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property=og:site_name content=Gizra><meta property=og:title content="Thinking (And Choosing) Elm"><link rel=apple-touch-icon sizes=180x180 href=/assets/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/assets/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/favicons/favicon-194x194.png sizes=194x194><link rel=icon type=image/png href=/assets/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/assets/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=/assets/favicons/manifest.json><meta name=msapplication-TileColor content=#000000><meta name=msapplication-TileImage content=/assets/favicons/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Esteban" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:500,700" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css integrity="sha256-wT6CFc7EKRuf7uyVfi+MQNHUzojuHN2pSw0YWFt2K5E=" crossorigin="anonymous"/><link rel=stylesheet href="/assets/stylesheets/style.css"/><script src=https://code.jquery.com/jquery-2.2.4.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js integrity="sha256-flVaeawsBV96vCHiLmXn03IRJym7+ZfcLVvUWONCas8=" crossorigin=anonymous></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');</script></head><body class=pushable><div class="ui sidebar inverted vertical menu left"><a class="item active" href="/">Home</a> <a class=item href=/team>Team</a> <a class=item href=/blog>Blog</a> <a class=item href=/projects>Projects</a> <a class=item href=/our-story>Our Story</a> <a class=item href=/contact>Contact</a></div><div class=pusher><div class="ui grid container"><header class=row><div class="five wide column menu bar"><div class="ui large secondary menu"><a class="item sidebar-toggle"><i class="big sidebar icon"></i> Menu</a></div></div><div class="six wide computer six wide tablet eleven wide mobile column center aligned"><a class=gizra-logo href="/"><svg xmlns=http://www.w3.org/2000/svg width=252 height=104><title>gizra</title><path fill=#E27058 fill-rule=evenodd d="M44.3 21.6c.2 3.5 3 5.4 6 5.4 3.5 0 6.7-2 6.7-7s-3.6-7.7-8.5-7.7c-4.3 0-10.3 2.5-10.3 11 0 1.7.2 3.4.6 5.3-3.4-2-6.5-2.6-11.6-2.6-16 0-22.7 7.6-22.7 17.5 0 8.7 4 13.7 12.2 16-8.2 5-12 7.8-12 13.8C4.7 78 8 83 20.7 83h10c11 0 13.4 2 13.4 7 0 6.7-5.8 11.3-17 11.3s-13.4-4.7-13.4-9c0-1.8.2-3.5 1-5.8l-6.4-3C4.5 84.8.2 87 .2 92c0 6.8 7.5 11.3 25.8 11.3 21.2 0 29.6-8.5 29.6-20 0-14.4-12-17.2-23.8-17.2H21c-5.5 0-6.6-.4-6.6-1.4 0-1 1-2 4.6-4.4 2.2.4 5.4.8 8.5.8C40.3 61 49 55 49 43c0-6.8-4-10.5-8-13.3-.6-2.5-.8-4.6-.8-6.3 0-6.5 3-7 4.5-7 2.2 0 2.8 1.7 2.5 3.4l-3 1.8zM22 41.2C22 29.7 24 28 27 28s4.6 1.4 4.6 13.2v5c0 11-1.8 12.7-4.6 12.7-3.2 0-5-2.3-5-12V41zM62 10c0 4.4 2 9.8 10.6 9.8 7.6 0 10.6-4.3 10.6-10 0-6.3-3.8-9.6-10.4-9.6C65 .2 62 5 62 10zm-5.4 17v2h6.2v46H57v2h31.2v-2h-6V27H56.7zm82.5 0H95l-1.4 20.2H95c4.3-15 8-18.3 22.2-18.3h1L93 75.3V77h44l1.8-21.5h-1.5C133.5 69 127.5 75 115.6 75h-1.4l25-46v-2zm41 3c2.2 0 4.3 1 2.2 5.3h-3.8c-2.2 7.5 1 12 8.2 12 5.6 0 8.8-4 8.8-10 0-8-5-11.3-11.2-11.3-6.3 0-12 3.6-14 11V27H145v2h5.7v46h-5.8v2h32.6v-2h-7.4V47c0-9.5 4.7-17 9.7-17zm40.5 22.3c-15 0-24.2 2.4-24.2 13 0 10.5 8.2 12.8 15.6 12.8 7.2 0 10.3-2.7 12-7.7 1.2 5 6 7.8 14.4 7.8 9 0 13-3.5 13.5-16l-1.7-.2c-.5 8.8-2.3 10.8-4.2 10.8-1.7 0-3-1.2-3-5.5V46c0-15.2-5.5-19.8-22-19.8-14.3 0-22 4-22 13 0 5 2.6 8.6 9 8.6 5.3 0 9.3-3.3 9.3-8.2 0-2-.3-3.4-.8-4.7H214c-.6-1.2-.8-2.2-.8-3 0-3.4 3-4.3 5-4.3 4.2 0 5.3 3.5 5.3 16.8v8h-3zM219 73.8c-2 0-2.7-1-2.7-8.6v-1.6c0-6.4 2-9.6 6.5-9.6h.7v9.8c0 6.7-2.5 10-4.5 10z"/></svg></a><div class=tagline>We Build Websites</div></div><div class="five wide computer only column"></div></header><div class="ui grid centered post"><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column"><div class="ui raised padded segment"><h1 class="ui dividing header"><div class="ui image"><img src=/assets/images/team/avatars/amitaibu.jpg class="ui circular image"></div><div class=content><a href="/content/thinking-choosing-elm/">Thinking (And Choosing) Elm</a><div class="sub header">By Amitai Burstein (@amitaibu) // 22 Oct 2015</div></div><div class="right floated column"><a href=/blog class="ui teal right ribbon big label">Blog Post</a></div></h1><p>In my <a href="https://www.gizra.com/content/elmlang-headless-drupal/">last post</a> I was giving a high level overview of why we were looking at Elm in Gizra. Since that post, we’ve almost completed the <a href=https://gizra.github.io/elm-hedley>demo app</a>, and we’ve changed our status from “Looking at Elm” to “Choosing Elm”.</p><p>The reason? In short - I believe it will save us money.<br/>(Oh, and it’s fun)</p><div class="ui segments"><div class="ui attached center aligned segment"><iframe src=https://gfycat.com/ifr/BountifulGloomyChickadee frameborder=0 scrolling=no width=100% height=555 style="-webkit-backface-visibility: hidden;-webkit-transform: scale(1)"></iframe></div></div><h2 id=pro--cons>Pro &amp; Cons</h2><p>Lets start with the main Elm cons:</p><ul><li>It’s not mainstream.</li><li>Community is small, which means there aren’t tons of libraries out there, so you’ll have to scratch your own itch more often then not.</li><li>There aren’t many blog posts/tutorials out there, surely compared to popular frameworks such as React.</li><li>High learning curve with a new unknown syntax which is not JS.</li><li>It’s different from other things we know.</li></ul><p>And the pros, which are totally subjective:</p><ul><li>It’s not JS. Obviously this statement is controversial, but it’s no secret that JS can be very <a href="http://dorey.github.io/JavaScript-Equality-Table/">confusing</a>.</li><li>Having this high learning curve has an interesting side effect: all the developers in the issue queue/mailing list, even the newbies, are seasoned developers. It’s amazing to see how rapidly newcomers learn the new stuff, and contribute back.</li><li>Once you pick up the concepts, and follow the <a href="https://github.com/evancz/elm-architecture-tutorial/">Elm architecture</a>, the pieces start falling really neatly into their natural place. Each component in your app has the exact same structure as the other components and the root component itself.</li><li>There’s a compiler that stops you from screwing things up - as we humans constantly tend to do.</li><li>It’s different from other things we know. I think it’s actually good, because we kind of had enough of “the old way” (read as “Angular 1”). Even <a href="http://aurelia.io/">Aurelia</a> with its great DX and even React &amp; <a href="http://redux.js.org/">Redux</a> with their immense popularity and community felt as a step in the right direction, but not the radical new approach to the problem we were looking for.</li></ul><h2 id=approaching-a-project>Approaching a Project</h2><p>I hope that, like us, you enjoy seeing how the same backend can be served by different front-ends. Starting from the trusty old Angular (which we love to complain about, but still have a warm place in our hearts for), to <a href="/content/headless-drupal-terminal/">crazy node.js</a> running in your console, and now to Elm.</p><p>I’d like to share a small example of how we approach the same feature, both in Angular and in Elm. The demo app itself isn’t super complicated, but it’s already doing a lot of stuff typical apps need to do:</p><ol><li>Log in a user, and authenticate against a <a href=https://github.com/RESTful-Drupal/restful>RESTful backend</a> (Drupal in our case, but that’s obviously completely hidden from the front - the client just sees clean JSON).</li><li>Fetch a set of events from the backend the user has access to, and present them in a filterable list, along with a map showing their geo-locations.</li><li>Have a simple “My account” page.</li><li>Remember the user by keeping an access token in localStorage, so they won’t have to re-login over and over again.</li><li>Have the URL change when switching pages.</li></ol><p>I’d like to concentrate on this last point. Getting the router working on our Elm app helped me realize we were approaching the routing task incorrectly while we were using Angular.</p><p>When structuring the app in Angular, setting up the router using the popular ui-router module is one of the first tasks we used to do. While ui-router is working with the concept of states, the URL is baked directly into it.<br/>So immediately each page had its own URL, but we were now shaping our app around ui-router’s logic. Having the root level app know so much about each page (e.g. which <code class=highlighter-rouge>templateUrl</code> to load) or deal with the access via <code class=highlighter-rouge>onEnter</code> was a sign that something was off.</p><div class="language-js highlighter-rouge"><pre class=highlight><code><span class=p>.</span><span class=nx>state</span><span class=p>(</span><span class=s1>'my-account'</span><span class=p>,</span> <span class=p>{</span>
  <span class=na>url</span><span class=p>:</span> <span class=s1>'my-account'</span><span class=p>,</span>
  <span class=na>templateUrl</span><span class=p>:</span> <span class=s1>'user.html'</span><span class=p>,</span>
  <span class=na>controller</span><span class=p>:</span> <span class=s1>'UserCtrl'</span><span class=p>,</span>
  <span class=na>onEnter</span><span class=p>:</span> <span class=nx>page403</span><span class=p>,</span>
  <span class=na>resolve</span><span class=p>:</span> <span class=p>{</span>
    <span class=na>account</span><span class=p>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>Account</span><span class=p>)</span> <span class=p>{</span>
      <span class=c1>// Resolve the user's account before we navigate to the page.</span>
      <span class=k>return</span> <span class=nx>Account</span><span class=p>.</span><span class=nx>get</span><span class=p>();</span>
    <span class=p>},</span>
  <span class=p>}</span>
<span class=p>})</span>
</code></pre></div><h2 id=url-change-is-not-routing>URL Change Is Not Routing</h2><p>In our Elm app, getting the URL mapped to a page was in fact the <em>last</em> step, not the first. Let’s see how this can be accomplished and how by following the Elm architecture we were able to better model our app.</p><p>First, we need to remember Elm takes a highly centralized approach - the entire app state is kept in one big record, which is the “single source of truth” of our app. It might feel unnatural initially, but the gains are immediate.</p><p>We’ll start by defining our <code class=highlighter-rouge>Model</code>. It has an <code class=highlighter-rouge>activePage</code> property which will hold the state of the page being viewed. An <code class=highlighter-rouge>activePage</code> is of type <code class=highlighter-rouge>Page</code>, that we define ourself - an arbitrary list of our pages. That’s it.<br/>Once we’ve modeled it like that, it makes it easier to reason with and understand that our single page application has a property that holds the info on which page is active. It might sound over simplified but it actually is as simple as that.</p><p>For a more advanced use case we could even add a second property called <code class=highlighter-rouge>nextPage</code> which has the value of a <code class=highlighter-rouge>Maybe Page</code>. The <code class=highlighter-rouge>Maybe</code> signifies that it <em>might</em> have a <code class=highlighter-rouge>Page</code> value, or might not (i.e. <code class=highlighter-rouge>Nothing</code>).<br/>The <code class=highlighter-rouge>nextPage</code> will be used whenever we try to login for the first time, and want to redirect the user to the next page. So the <code class=highlighter-rouge>activePage</code> would be <code class=highlighter-rouge>User</code> (which is the login form), and the next page that the user will be redirected to after being logged in is <code class=highlighter-rouge>Just Event</code> (the <code class=highlighter-rouge>Just</code> prefix means we have a value here - it’s the opposite of using <code class=highlighter-rouge>Nothing</code>).</p><div class="language-haskell highlighter-rouge"><pre class=highlight><code><span class=kr>type</span> <span class=kt>Page</span>
  <span class=o>=</span> <span class=kt>Event</span>
  <span class=o>|</span> <span class=kt>User</span>

<span class=kr>type</span> <span class=n>alias</span> <span class=kt>Model</span> <span class=o>=</span>
  <span class=p>{</span> <span class=n>activePage</span> <span class=o>:</span> <span class=kt>Page</span>
  <span class=c1>-- If the user is anonymous, we want to know where to redirect them</span>
  <span class=c1>-- after being logged in.</span>
  <span class=p>,</span> <span class=n>nextPage</span> <span class=o>:</span> <span class=kt>Maybe</span> <span class=kt>Page</span>
  <span class=p>}</span>
</code></pre></div><p>Next lets cover how the active page will be changed. In Elm every change to our model is very explicit, and only a predefined <code class=highlighter-rouge>Action</code> can cause an update to our model. This means every single interaction the user has with the app is not automatically converted into data (i.e. no two way data binding).<br/>Even updating the name and password field on every key stroke need to be explicitly wired into our app. A little more verbose, but helpful in following and maintaining our app, as any change to the state or data is very clear.</p><p>So we will define the action that sets the active page. This action is the one and only entry point for changing the active page. The below code says, there’s an action called <code class=highlighter-rouge>SetActivePage</code> and it will get an argument of type <code class=highlighter-rouge>Page</code> - in our example, <code class=highlighter-rouge>User</code> or <code class=highlighter-rouge>Event</code> are the only allowed values.</p><div class="language-haskell highlighter-rouge"><pre class=highlight><code><span class=kr>type</span> <span class=kt>Action</span>
  <span class=o>=</span> <span class=kt>SetActivePage</span> <span class=kt>Page</span>
</code></pre></div><p>We’ve actually defined the most important parts - our model and action. Next we’ll have to define how our app will behave once <code class=highlighter-rouge>SetActivePage</code> is triggered. While this <a href=https://github.com/Gizra/elm-hedley/blob/d052dbac36dfbe801ed94ee085627b556252c861/src/elm/App.elm#L136-L176>update function</a> could be found valuable for devs learning Elm, I’d argue that it’s the less interesting part - it’s “just” an implementation detail.<br/>In fact, the update function is likely to evolve as our app grows, but the conceptual foundation we laid in the Model and Action, is most probably going to remain as is.</p><p>Finally, by using @rgrempel well documented <a href=https://github.com/rgrempel/elm-route-hash>elm-router-hash</a> package we <a href=https://github.com/Gizra/elm-hedley/blob/d052dbac36dfbe801ed94ee085627b556252c861/src/elm/App.elm#L241>map</a> the <code class=highlighter-rouge>activePage</code> property of our model to the URL, so whenever it changes the URL changes as-well.</p><p>This is where I personally realized that the URL change which up until now I incorrectly called “the router” is just a <em>side effect</em> to the actual routing - the <code class=highlighter-rouge>SetActivePage</code>.</p><p>This isn’t just semantics. By moving all the logic into a single action that controls setting the page, we can make sure that for example access control is respected no matter where the page is set, from the URL or programtically.</p><h2 id=baby-steps>Baby Steps</h2><p>I encourage you to learn Elm and see how it can be integrated with your Headless Drupal installation. Even if ultimately you decide not to use it for production, just being exposed to this different approach will be worth your while.</p><p>Some good resources are:</p><ul><li>The official <a href=http://elm-lang.org/docs>docs</a></li><li>The <a href="https://github.com/evancz/elm-architecture-tutorial/">Elm architecture tutorials</a></li><li>Online courses by <a href=https://pragmaticstudio.com>Pragmatic Studio</a> (Paid, but well worth it)</li><li>The official <a href=https://groups.google.com/forum/#!forum/elm-discuss>mailing list</a></li><li><a href=https://github.com/Gizra/elm-hedley>Elm-hedley</a> demo app</li></ul></div></div><div class="twelve wide column computer only"><div class="ui borderless secondary menu"><a class=item href="/content/elmlang-headless-drupal/"><i class="chevron left icon"></i> Elm Loves Headless Drupal</a><div class="right menu"><a class=item href="/content/decoupled-drupal-drupalcon-los-angeles/">Decoupled Drupal: When, Why, and How - The Video <i class="chevron right icon"></i></a></div></div></div><div class="twelve wide column"><div class="ui segment basic"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><footer class="ui black inverted vertical footer segment padded"><div class="ui center aligned container"><div class="ui three column stackable inverted grid"><div class=column><address><div class=strong>Israel Headquarters</div><div>5 Brenner Street, Tel Aviv</div><a class=telephone href=tel:+97233731222>+972-3-3731222</a> // <a class=email href=mailto:info@gizra.com>info@gizra.com</a></address></div><div class="column icons"><a target=_blank href=https://twitter.com/gizra_drupal><i class="twitter huge icon"></i></a> <a target=_blank href=https://github.com/Gizra/gizra.com><i class="github huge icon"></i></a></div><div class=column><address><div class=strong>North America Office</div><div>350 N. Orleans Street, Suite 9000N, Chicago, IL 60647</div><a class=telephone href=tel:+13125857625>312-585-7625</a> // <a class=email href=mailto:usoffice@gizra.com>usoffice@gizra.com</a></address></div></div></div></footer></div><script src=/bower_components/anchor-js/anchor.min.js></script><script src=/assets/javascript/script.js></script></body></html>