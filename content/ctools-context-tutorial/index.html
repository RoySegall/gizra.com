<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      
    

<title>CTools context tutorial</title>


      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
      <meta content="Gizra" property="og:site_name">

      
        <meta content="CTools context tutorial" property="og:title">
      

      

      

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.5691.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.e5f8.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.17e1.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.7353.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.e27e.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


      <!-- Begin Inspectlet Embed Code -->
      <script type="text/javascript" id="inspectletjs">
      window.__insp = window.__insp || [];
      __insp.push(['wid', 314054580]);
      (function() {
      function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
      setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
      })();
      </script>
      <!-- End Inspectlet Embed Code -->

    </head>
    <body>

    <!-- Main content -->
    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<header id="header-global">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        
  

<span class="gizra-logo"><a href="/">gizra</a></span>
<h1 class="sr-only">Gizra</h1>
<nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/#about" class="smooth-scroll-to">About</a></li>
      <li><a href="/services">Our Work</a></li>
      <li><a href="/team">Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/fit">Do We Fit?</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>
  </div>
</nav>

      </div>
    </div>
  </div>
</header>
<article id="post-page">
  <div class="container">
    <div class="row">
      <div id="post-title" class="col-sm-10 col-sm-offset-1">
        <h1><a href="/content/ctools-context-tutorial/">CTools context tutorial </a></h1>
        <div class="post-author">By Amitai Burstein</div>
      </div>
    </div>
    <div class="row">
      <div id="post-data" class="col-sm-2 col-sm-offset-1">
  			<div id="post-label">
  		 		<a href="/blog"><span class="label label-default">Gizra Blog</span></a>
  			</div>
        <div class="date">11 May 2011</div>
        <section class="author-details">
          <div class="image-wrapper">
            <img src="/images/team/avatars/amitaibu.42a1.jpg" class="img-circle img-responsive">
          </div>
          <div class="text-wrapper">
            <span class="name">Amitai Burstein</span>
            
              <span class="twitter">(@amitaibu)</span>
            
            <div class="title">CTO, Co-Owner</div>
            <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
          </div>
        </section>
        <div class="tags">
          <div class="title">Tags:</div>
          
            <ul class="inline">
              
              

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#tutorial-ref">tutorial</a></li>
    
      <li><a href="/tags.html#CTools-ref">CTools</a></li>
    
  


            </ul>
          
        </div>
      </div>
      <div id="post-content" class="col-sm-8">

        <p>Why should you use panels node-preview-example module? You shouldn&rsquo;t, it&rsquo;s just an example ;)</p>

<p>This post covers how to build a CTools content-type plugin that has context. CTools &ldquo;Context&rdquo; should not be mistaken with the context module. Context is CTools way of saying, my plugin (read, block) shouldn&rsquo;t be dumb. If it requires a node or a user to extract data from, then it should let others know about it. &ldquo;Others&rdquo; in our case is Page manager module. It will load the context for the plugins and hand it over. In fact, if the context is not present it will not even bother loading the plugin.</p>

<p>I have created an example module called node-preview-example, that you can simply download and enable, create an Article page, and see how Panels is now showing the body field on the left and on the right a (silly) &ldquo;Summary&rdquo; of the node &ndash; this is our plugin.</p>

<!-- more -->
<div class="highlight"><pre><code class="text language-text" data-lang="text">drush dl ctools panels features
drush en ctools page_manager panels features
</code></pre></div>
<p>And the example module is in my <a href="http://drupal.org/sandbox/noam.hrz/1148086">sandbox</a>:
<code>
git clone http://git.drupal.org/sandbox/noam.hrz/1148086.git node_preview_example
</code></p>

<p>Let&rsquo;s go over the important parts in the code.</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="sd">/**</span>
<span class="sd"> * Plugin definition.</span>
<span class="sd"> */</span>
<span class="nv">$plugin</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
  <span class="o">...</span>

  <span class="s1">&#39;required context&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
    <span class="k">new</span> <span class="nx">ctools_context_required</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;User&#39;</span><span class="p">),</span> <span class="s1">&#39;user&#39;</span><span class="p">),</span>
    <span class="k">new</span> <span class="nx">ctools_context_required</span><span class="p">(</span><span class="nx">t</span><span class="p">(</span><span class="s1">&#39;Node&#39;</span><span class="p">),</span> <span class="s1">&#39;node&#39;</span><span class="p">),</span>
  <span class="p">),</span>
  <span class="o">...</span>
<span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>The plugin definition  is where we let the system know we need a user object and a node object to operate on.</p>

<p>Next the render callback can use those context, after making sure they are valid.</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * Render callback.</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">node_preview_example_summary_content_type_render</span><span class="p">(</span><span class="nv">$subtype</span><span class="p">,</span> <span class="nv">$conf</span><span class="p">,</span> <span class="nv">$args</span><span class="p">,</span> <span class="nv">$context</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Seperating the context to two different variables</span>
  <span class="k">list</span><span class="p">(</span><span class="nv">$user_context</span><span class="p">,</span> <span class="nv">$node_context</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$context</span><span class="p">;</span>

  <span class="c1">// Make sure that context variable arent empty.</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$user_context</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$user_context</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$node_context</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$node_context</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Above we made sure we got the context.</span>
  <span class="nv">$node</span> <span class="o">=</span> <span class="nv">$node_context</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">;</span>

  <span class="o">...</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>As you can see, it didn&rsquo;t take much to get the context working, but it gives a lot of power:</p>

<ul>
<li>Plugins without satisfied context will not appear in the plugins list, so a user can&rsquo;t add them by mistake</li>
<li>There is one single way for plugins to get a context, unlike &ldquo;dumb&rdquo; blocks that each one needs to find out where they are (e.g. &ldquo;menu_get_item()&rdquo; over and over again).</li>
</ul>

<p>If you listen to talks about Butler module, and having a plugin and context system in D8 - it will probably very similar or at least learn a lot from CTools plugins and context system, so you know you are on the right path.</p>


      </div>
    </div>
  </div>
</article>
<section id="post-nav">
  <div class="container">
    <div class="row">
      <div class="col-sm-3 col-sm-offset-3 col-xs-6 previous">
        
        <a href="/content/data-migration-part-2/">
          <div id="previous-label" class="text-small">
            <span class="hidden-xs"><i class="fa fa-chevron-circle-left"></i>&nbsp;Data Migration - part 2</span>
            <span class="visible-xs"><i class="fa fa-chevron-circle-left"></i>&nbsp;Previous post</span>
          </div>
        </a>
        
      </div>
      <div class="col-sm-3 col-sm-offset-2 col-xs-6 next">
        
        <a href="/content/og-7x-11-rc2-out/">
          <div id="next-label" class="text-small">
            <span class="hidden-xs">OG 7.x-1.1-RC2 is out! &nbsp;<i class="fa fa-chevron-circle-right"></i></span>
            <span class="visible-xs">Next post&nbsp;<i class="fa fa-chevron-circle-right"></i></span>
          </div>
        </a>
        
      </div>
    </div>
  </div>
</section>
<section>
  <div class="container">
    <div class="row">
      <div class="col-sm-8 col-sm-offset-3">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </div>
  </div>
</section>
    


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer" role="contentinfo">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner Street, Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">North America Office</div>
                    <span>106 West 32nd Street, 2nd Floor, New York, NY 10001</span>
                    <a class="telephone" href="tel:+13476864508">212-634-1687</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link github">
                      <a href="https://github.com/Gizra" target="_blank"><i class="fa fa-github-square"></i><span class="link-text">Gizra's Github Account</span></a>
                    </span>
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank"><i class="fa fa-twitter-square"></i><span class="link-text">Gizra's Twitter Account</span></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank"><i class="fa fa-linkedin-square"></i><span class="link-text">Gizra's LinkedIn Page</span></a>
                    </span>
                    <span class="link facebook">
                      <a href="https://www.facebook.com/gizraltd/timeline" target="_blank"><i class="fa fa-facebook-square"></i><span class="link-text">Gizra's Facebook Page</span></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.806b.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.f755.js"></script>
    </body>
</html>
