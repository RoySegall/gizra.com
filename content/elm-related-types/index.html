<!DOCTYPE html><html><head><title>Expressing a Relationship between Multiple Types in Elm</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property=og:site_name content=Gizra><meta property=og:title content="Expressing a Relationship between Multiple Types in Elm"><meta name=description content="What options do you have when Elm types have something in common? Have you considered type classes?"><meta property=og:description content="What options do you have when Elm types have something in common? Have you considered type classes?"><meta name=twitter:card content="summary_large_image"/><meta name=twitter:site content="@gizra_drupal"/><meta property=og:image content=https://www.gizra.com/assets/images/posts/elm-related-types/thumb.jpg><link rel=apple-touch-icon sizes=180x180 href=/assets/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/assets/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/favicons/favicon-194x194.png sizes=194x194><link rel=icon type=image/png href=/assets/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/assets/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=/assets/favicons/manifest.json><meta name=msapplication-TileColor content=#000000><meta name=msapplication-TileImage content=/assets/favicons/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Esteban" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:500,700" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css integrity=sha384-370KB8zqOlHxys9dcOyC7aCeXVtGyiKkWkp+cn8Mfoi13/sPj7fvSuhKRRdFbcip crossorigin=anonymous><link rel=stylesheet href="/assets/stylesheets/style.css"/><script src=https://code.jquery.com/jquery-2.2.4.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js integrity=sha384-xfhRYqbW4Asj6UIfXB+Fp7GsmhF9uCf4R+oIGrp7YaBMAmlQWihnvGrW2WbdQRIS crossorigin=anonymous></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');</script></head><body class=pushable><div class="ui sidebar inverted vertical menu left"><a class="item active" href="/">Home</a> <a class=item href=/team>Team</a> <a class=item href=/blog>Blog</a> <a class=item href=/podcast>Podcast</a> <a class=item href=/projects>Projects</a> <a class=item href=/our-story>Our Story</a> <a class=item href=/contact>Contact</a></div><div class=pusher><div class="ui grid container"><header class=row><div class="five wide column menu bar"><div class="ui large secondary menu"><a class="item sidebar-toggle"><i class="big sidebar icon"></i> Menu</a></div></div><div class="six wide computer six wide tablet eleven wide mobile column center aligned"><a class=gizra-logo href="/"><svg xmlns=http://www.w3.org/2000/svg width=252 height=104><title>gizra</title><path fill=#E27058 fill-rule=evenodd d="M44.3 21.6c.2 3.5 3 5.4 6 5.4 3.5 0 6.7-2 6.7-7s-3.6-7.7-8.5-7.7c-4.3 0-10.3 2.5-10.3 11 0 1.7.2 3.4.6 5.3-3.4-2-6.5-2.6-11.6-2.6-16 0-22.7 7.6-22.7 17.5 0 8.7 4 13.7 12.2 16-8.2 5-12 7.8-12 13.8C4.7 78 8 83 20.7 83h10c11 0 13.4 2 13.4 7 0 6.7-5.8 11.3-17 11.3s-13.4-4.7-13.4-9c0-1.8.2-3.5 1-5.8l-6.4-3C4.5 84.8.2 87 .2 92c0 6.8 7.5 11.3 25.8 11.3 21.2 0 29.6-8.5 29.6-20 0-14.4-12-17.2-23.8-17.2H21c-5.5 0-6.6-.4-6.6-1.4 0-1 1-2 4.6-4.4 2.2.4 5.4.8 8.5.8C40.3 61 49 55 49 43c0-6.8-4-10.5-8-13.3-.6-2.5-.8-4.6-.8-6.3 0-6.5 3-7 4.5-7 2.2 0 2.8 1.7 2.5 3.4l-3 1.8zM22 41.2C22 29.7 24 28 27 28s4.6 1.4 4.6 13.2v5c0 11-1.8 12.7-4.6 12.7-3.2 0-5-2.3-5-12V41zM62 10c0 4.4 2 9.8 10.6 9.8 7.6 0 10.6-4.3 10.6-10 0-6.3-3.8-9.6-10.4-9.6C65 .2 62 5 62 10zm-5.4 17v2h6.2v46H57v2h31.2v-2h-6V27H56.7zm82.5 0H95l-1.4 20.2H95c4.3-15 8-18.3 22.2-18.3h1L93 75.3V77h44l1.8-21.5h-1.5C133.5 69 127.5 75 115.6 75h-1.4l25-46v-2zm41 3c2.2 0 4.3 1 2.2 5.3h-3.8c-2.2 7.5 1 12 8.2 12 5.6 0 8.8-4 8.8-10 0-8-5-11.3-11.2-11.3-6.3 0-12 3.6-14 11V27H145v2h5.7v46h-5.8v2h32.6v-2h-7.4V47c0-9.5 4.7-17 9.7-17zm40.5 22.3c-15 0-24.2 2.4-24.2 13 0 10.5 8.2 12.8 15.6 12.8 7.2 0 10.3-2.7 12-7.7 1.2 5 6 7.8 14.4 7.8 9 0 13-3.5 13.5-16l-1.7-.2c-.5 8.8-2.3 10.8-4.2 10.8-1.7 0-3-1.2-3-5.5V46c0-15.2-5.5-19.8-22-19.8-14.3 0-22 4-22 13 0 5 2.6 8.6 9 8.6 5.3 0 9.3-3.3 9.3-8.2 0-2-.3-3.4-.8-4.7H214c-.6-1.2-.8-2.2-.8-3 0-3.4 3-4.3 5-4.3 4.2 0 5.3 3.5 5.3 16.8v8h-3zM219 73.8c-2 0-2.7-1-2.7-8.6v-1.6c0-6.4 2-9.6 6.5-9.6h.7v9.8c0 6.7-2.5 10-4.5 10z"/></svg></a><div class=tagline>We Build Websites</div></div><div class="five wide computer only column"></div></header><div class="ui grid centered post"><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column"><div class="ui raised padded segment"><h1 class="ui dividing header"><div class="ui image"><img src=/assets/images/team/avatars/rgrempel.jpg class="ui circular image"></div><div class=content><a href="/content/elm-related-types/">Expressing a Relationship between Multiple Types in Elm</a><div class="sub header">By Ryan Rempel (@rgrempel) // 06 Feb 2018</div></div><div class="right floated column"><a href=/blog class="ui teal right ribbon big label">Blog Post</a></div></h1><p>Elm’s type system is sufficiently sophisticated that you’ll often want to make fine-grained distinctions between roughly similar types. In a <a href=/projects/#e-heza-emr-application>recent project</a>, for instance, we ended up with a separate type for a <code class=highlighter-rouge>Mother</code> and a <code class=highlighter-rouge>Child</code>.<sup id=fnref:nofathers><a href=#fn:nofathers class=footnote>1</a></sup> Now, a <code class=highlighter-rouge>Mother</code> is a little different than a <code class=highlighter-rouge>Child</code>. Most obviously, mothers have children, whereas (at least, in our data model) children do not. So, it was nice for them to be separate types. In fact, there were certain operations which could be done on a <code class=highlighter-rouge>Mother</code> but not a <code class=highlighter-rouge>Child</code> (and vice versa). So it was nice to be able to enforce that at the type level.</p><p>Yet, a <code class=highlighter-rouge>Mother</code> and a <code class=highlighter-rouge>Child</code> clearly have a lot in common as well. For this reason, it sometimes felt natural to write functions that could accept either. So, in those cases, it was a little awkward for them to be separate types. Something was needed to express a relationship between the two types.</p><p>What alternatives are available to do this sort of thing in Elm? Which did we end up choosing? For answers to these questions, and more, read on!</p><h2 id=our-data-model>Our Data Model</h2><p>Before proceeding further, here’s a little excerpt from our data model, to get us started. Of course, some of this would have been a little different had we chosen a different approach, so we’ll explore that as well. But this will give you a sense of the kind of data we were working with. (I’ve simplified things a bit, compared with the actual app).</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=kt>Gender</span>
        <span class=o>=</span> <span class=kt>Female</span>
        <span class=o>|</span> <span class=kt>Male</span>

    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Child</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>name</span> <span class=p>:</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>avatarUrl</span> <span class=p>:</span> <span class=kt>Maybe</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>motherId</span> <span class=p>:</span> <span class=kt>MotherId</span>
        <span class=o>,</span> <span class=n>birthDate</span> <span class=p>:</span> <span class=kt>NominalDate</span>
        <span class=o>,</span> <span class=n>gender</span> <span class=p>:</span> <span class=kt>Gender</span>
        <span class=p>}</span>

    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Mother</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>name</span> <span class=p>:</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>avatarUrl</span> <span class=p>:</span> <span class=kt>Maybe</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>children</span> <span class=p>:</span> <span class=kt>List</span> <span class=kt>ChildId</span>
        <span class=o>,</span> <span class=n>birthDate</span> <span class=p>:</span> <span class=kt>NominalDate</span>
        <span class=p>}</span>

    <span class=k>type</span> <span class=kt>MotherId</span> <span class=o>=</span>
        <span class=kt>MotherId</span> <span class=kt>Int</span>

    <span class=k>type</span> <span class=kt>ChildId</span> <span class=o>=</span>
        <span class=kt>ChildId</span> <span class=kt>Int</span>
</code></pre></div></div><p>You’ll notice that each <code class=highlighter-rouge>Child</code> has a reference not to a <code class=highlighter-rouge>Mother</code>, but to a <code class=highlighter-rouge>MotherId</code>. Similarly, each <code class=highlighter-rouge>Mother</code> has a list of <code class=highlighter-rouge>ChildId</code>, not a list of <code class=highlighter-rouge>Child</code>. The reasons we do things this way are a little subtle – perhaps they deserve a blog post of their own someday. (Amongst other things, it keeps the client data model closer to the data model on the backend, which makes JSON encoding and decoding simpler). However, it does mean that we need some kind of “container” type in order to get actual children and mothers. In our case, the relevant parts of that type looked something like this (again, I’ve simplified a little bit compared to the actual app):</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Container</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>mothers</span> <span class=p>:</span> <span class=kt>EveryDict</span> <span class=kt>MotherId</span> <span class=kt>Mother</span>
        <span class=o>,</span> <span class=n>children</span> <span class=p>:</span> <span class=kt>EveryDict</span> <span class=kt>ChildId</span> <span class=kt>Child</span>
        <span class=o>,</span> <span class=n>motherMeasurements</span> <span class=p>:</span> <span class=kt>EveryDict</span> <span class=kt>MotherId</span> <span class=kt>MotherMeasurements</span>
        <span class=o>,</span> <span class=n>childMeasurements</span> <span class=p>:</span> <span class=kt>EveryDict</span> <span class=kt>ChildId</span> <span class=kt>ChildMeasurements</span>
        <span class=p>}</span>

    <span class=k>type</span> <span class=k>alias</span> <span class=kt>MotherMeasurements</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>familyPlanningMethod</span> <span class=p>:</span> <span class=kt>List</span> <span class=kt>FamilyPlanningMethod</span>
        <span class=p>}</span>

    <span class=k>type</span> <span class=k>alias</span> <span class=kt>ChildMeasurements</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>height</span> <span class=p>:</span> <span class=kt>List</span> <span class=kt>Height</span>
        <span class=o>,</span> <span class=n>weight</span> <span class=p>:</span> <span class=kt>List</span> <span class=kt>Weight</span>
        <span class=o>,</span> <span class=n>photo</span> <span class=p>:</span> <span class=kt>List</span> <span class=kt>Photo</span>
        <span class=p>}</span>
</code></pre></div></div><p>Now, what are all these “measurements”? They were the main point of the app we were working on – we were collecting and displaying those measurements (and a few others I’ve omitted for the sake of simplicity).</p><p>Note that these measurements are themselves an example of related types. You could, for instance, say that <code class=highlighter-rouge>ChildMeasurements</code> is to <code class=highlighter-rouge>Child</code> as <code class=highlighter-rouge>MotherMeasurements</code> is to <code class=highlighter-rouge>Mother</code>. Furthermore, we needed another couple of related types to represent the various measurements at the data level (rather than just the type level)…something like:<sup id=fnref:singleton><a href=#fn:singleton class=footnote>2</a></sup></p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=kt>ChildActivity</span>
        <span class=o>=</span> <span class=kt>TakePhoto</span>
        <span class=o>|</span> <span class=kt>MeasureHeight</span>
        <span class=o>|</span> <span class=kt>MeasureWeight</span>

    <span class=k>type</span> <span class=kt>MotherActivity</span>
        <span class=o>=</span> <span class=kt>RecordFamilyPlanningMethod</span>
</code></pre></div></div><p>Now, these types are all reasonably sensible on their own. However, there is clearly some kind of relationship amongst them. You could even imagine giving names to some of those relationships:</p><ul><li><code class=highlighter-rouge>Child</code> and <code class=highlighter-rouge>Mother</code> could both be a kind of <code class=highlighter-rouge>Person</code>.</li><li><code class=highlighter-rouge>ChildMeasurements</code> and <code class=highlighter-rouge>MotherMeasurements</code> could both be a kind of <code class=highlighter-rouge>Measurement</code>.</li><li><code class=highlighter-rouge>ChildActivty</code> and <code class=highlighter-rouge>MotherActivity</code> could both be a kind of <code class=highlighter-rouge>Activity</code>.</li></ul><p>But how can we express those kind of relationships in Elm’s type system? Or, to put it another way, how might you fill in the gaps in this pseudo-code:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=kt>Person</span> <span class=o>=</span> <span class=o>???</span>

    <span class=k>type</span> <span class=kt>Measurement</span> <span class=o>=</span> <span class=o>???</span>

    <span class=k>type</span> <span class=kt>Activity</span> <span class=o>=</span> <span class=o>???</span>
</code></pre></div></div><p>To evaluate the available alternatives, you’ll need to know a little more about the sort of work that we wanted to do with these types – in other words, the functions we wanted to be able to write. In pseudo-code, here are some example function signatures that we ended up needing. (You can probably form an intuition about why we’d want most of these things, and we’ll discuss some of them in more detail below).</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>getAllActivities</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=kt>Activity</span>

    <span class=n>getAvatarUrl</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>String</span>

    <span class=n>getBirthDate</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>NominalDate</span>

    <span class=n>getChildren</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=kt>ChildId</span>

    <span class=n>getMotherId</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>MotherId</span>

    <span class=n>getName</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>String</span>

    <span class=n>hasPendingActivity</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Activity</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Bool</span>

    <span class=n>iconClass</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>String</span>

    <span class=n>getMeasurements</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Measurements</span>
</code></pre></div></div><p>So, what approaches are possible? I can think of four:</p><ol><li>Tagged types</li><li>Type classes</li><li>Just don’t do it</li><li>Extensible records</li></ol><h2 id=tagged-types>Tagged Types</h2><p>If what we want is to define a type that can either by a <code class=highlighter-rouge>Child</code> or a <code class=highlighter-rouge>Mother</code>, the simplest way of doing it is via a tagged type (sometimes referred to as a sum type, union type, or algebraic data type). That is the most basic way in which we can define something which might be one sort of thing or another sort of thing. So, a <code class=highlighter-rouge>Person</code> could be defined in this way:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=kt>Person</span>
        <span class=o>=</span> <span class=kt>Mother</span> <span class=kt>Mother</span>
        <span class=o>|</span> <span class=kt>Child</span> <span class=kt>Child</span>

    <span class=k>type</span> <span class=kt>PersonId</span>
        <span class=o>=</span> <span class=kt>PersonIdMother</span> <span class=kt>MotherId</span>
        <span class=o>|</span> <span class=kt>PersonIdChild</span> <span class=kt>ChildId</span>
</code></pre></div></div><p>What we have here is a kind of “wrapper” type (<code class=highlighter-rouge>Person</code>), which can be one of two things (either a <code class=highlighter-rouge>Child</code> or a <code class=highlighter-rouge>Mother</code>). To identify which it is, we re-use the words <code class=highlighter-rouge>Child</code> and <code class=highlighter-rouge>Mother</code> as “tags” which identify, for a particular <code class=highlighter-rouge>Person</code>, what sort of person it is.<sup id=fnref:tagsandtypes><a href=#fn:tagsandtypes class=footnote>3</a></sup></p><p>Now, this will no doubt be very familiar to you, and it is certainly the first thing you ought to think about when expressing this kind of relationship between types. It is the simplest approach, and often fits the bill admirably. Consider, for instance, how we might implement a few of the functions we sketched above:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>getAvatarUrl</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>String</span>
    <span class=n>getAvatarUrl</span> <span class=n>person</span> <span class=o>=</span>
        <span class=k>case</span> <span class=n>person</span> <span class=k>of</span>
            <span class=kt>Child</span> <span class=n>child</span> <span class=o>-&gt;</span>
                <span class=n>child</span><span class=o>.</span><span class=n>avatarUrl</span>

            <span class=kt>Mother</span> <span class=n>mother</span> <span class=o>-&gt;</span>
                <span class=n>mother</span><span class=o>.</span><span class=n>avatarUrl</span>

    <span class=n>iconClass</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>String</span>
    <span class=n>iconClass</span> <span class=n>person</span> <span class=o>=</span>
        <span class=k>case</span> <span class=n>person</span> <span class=k>of</span>
            <span class=kt>Child</span> <span class=n>_</span> <span class=o>-&gt;</span>
                <span class=s>"</span><span class=s2>child"</span>

            <span class=kt>Mother</span> <span class=n>_</span> <span class=o>-&gt;</span>
                <span class=s>"</span><span class=s2>mother"</span>

    <span class=n>getMotherId</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>MotherId</span>
    <span class=n>getMotherId</span> <span class=n>personId</span> <span class=n>container</span> <span class=o>=</span>
        <span class=k>case</span> <span class=n>personId</span> <span class=k>of</span>
            <span class=kt>PersonIdChild</span> <span class=n>id</span> <span class=o>-&gt;</span>
                <span class=kt>EveryDict</span><span class=o>.</span><span class=n>get</span> <span class=n>id</span> <span class=n>container</span><span class=o>.</span><span class=n>children</span>
                    <span class=o>|&gt;</span> <span class=kt>Maybe</span><span class=o>.</span><span class=n>map</span> <span class=o>.</span><span class=n>motherId</span>

            <span class=kt>PersonIdMother</span> <span class=n>id</span> <span class=o>-&gt;</span>
                <span class=kt>Just</span> <span class=n>id</span>

    <span class=n>getChildren</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=kt>ChildId</span>
    <span class=n>getChildren</span> <span class=n>personId</span> <span class=n>container</span> <span class=o>=</span>
        <span class=n>getMotherId</span> <span class=n>personId</span> <span class=n>container</span>
            <span class=o>|&gt;</span> <span class=kt>Maybe</span><span class=o>.</span><span class=n>andThen</span> <span class=p>(</span><span class=o>\</span><span class=n>id</span> <span class=o>-&gt;</span> <span class=kt>EveryDict</span><span class=o>.</span><span class=n>get</span> <span class=n>id</span> <span class=n>container</span><span class=o>.</span><span class=n>mothers</span><span class=p>)</span>
            <span class=o>|&gt;</span> <span class=kt>Maybe</span><span class=o>.</span><span class=n>map</span> <span class=o>.</span><span class=n>children</span>
            <span class=o>|&gt;</span> <span class=kt>Maybe</span><span class=o>.</span><span class=n>withDefault</span> <span class=p>[]</span>
</code></pre></div></div><p>That all works very well, so far. However, this approach turned out to have some pitfalls in our app, especially when we started implementing functions which depended on additional related types. Consider how one might express those other types:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=kt>Measurements</span>
        <span class=o>=</span> <span class=kt>MotherMeasurements</span> <span class=kt>MotherMeasurements</span>
        <span class=o>|</span> <span class=kt>ChildMeasurements</span> <span class=kt>ChildMeasurements</span>

    <span class=k>type</span> <span class=kt>Activity</span>
        <span class=o>=</span> <span class=kt>MotherActivity</span> <span class=kt>MotherActivity</span>
        <span class=o>|</span> <span class=kt>ChildActivity</span> <span class=kt>ChildActivity</span>

</code></pre></div></div><p>So far, so good, and some additional functions can be implemented in a perfectly reasonable way, e.g.:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>getAllActivities</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=kt>Activity</span>
    <span class=n>getAllActivities</span> <span class=n>person</span> <span class=o>=</span>
        <span class=k>case</span> <span class=n>person</span> <span class=k>of</span>
            <span class=kt>Mother</span> <span class=n>_</span> <span class=o>-&gt;</span>
                <span class=kt>List</span><span class=o>.</span><span class=n>map</span> <span class=kt>MotherActivity</span>
                    <span class=p>[</span> <span class=kt>RecordFamilyPlanningMethod</span> <span class=p>]</span>

            <span class=kt>Child</span> <span class=n>_</span> <span class=o>-&gt;</span>
                <span class=kt>List</span><span class=o>.</span><span class=n>map</span> <span class=kt>ChildActivity</span>
                    <span class=p>[</span> <span class=kt>TakePhoto</span>
                    <span class=o>,</span> <span class=kt>MeasureHeight</span>
                    <span class=o>,</span> <span class=kt>MeasureWeight</span>
                    <span class=p>]</span>
</code></pre></div></div><p>However, we start to run into some trouble when implementing functions that depend on multiple related types. Consider how we might implement <code class=highlighter-rouge>hasPendingActivity</code>. The original implementation looked something roughly like this (simplified a little compared to the actual app):</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>hasPendingActivity</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Activity</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Bool</span>
    <span class=n>hasPendingActivity</span> <span class=n>personId</span> <span class=n>activity</span> <span class=n>container</span> <span class=o>=</span>
        <span class=k>case</span> <span class=p>(</span> <span class=n>personId</span><span class=o>,</span> <span class=n>activity</span> <span class=p>)</span> <span class=k>of</span>
            <span class=p>(</span> <span class=kt>PersonIdMother</span> <span class=n>id</span><span class=o>,</span> <span class=kt>MotherActivity</span> <span class=n>motherActivity</span> <span class=p>)</span> <span class=o>-&gt;</span>
                <span class=n>hasPendingMotherActivity</span> <span class=n>id</span> <span class=n>motherActivity</span> <span class=n>container</span>

            <span class=p>(</span> <span class=kt>PersonIdChild</span> <span class=n>id</span><span class=o>,</span> <span class=kt>ChildActivity</span> <span class=n>childActivity</span> <span class=p>)</span> <span class=o>-&gt;</span>
                <span class=n>hasPendingChildActivity</span> <span class=n>id</span> <span class=n>childActivity</span> <span class=n>container</span>

            <span class=n>_</span> <span class=o>-&gt;</span>
                <span class=c1>-- Hmm. If we get here, we've got a mis-match between the</span>
                <span class=c1>-- personId type and the activity type ... one is suitable for</span>
                <span class=c1>-- a mother, but the other is suitable for a child. So, what</span>
                <span class=c1>-- answer should we give?</span>
                <span class=kt>Debug</span><span class=o>.</span><span class=n>crash</span> <span class=s>"</span><span class=s2>Mismatched parameters"</span>
</code></pre></div></div><p>Now, whenever you’re writing code and you think to yourself “we shouldn’t get here”, that’s a clue that you haven’t structured your types quite as well as you might. Ideally, you should be able to prove to the compiler that you can’t get there, so you don’t have to write the code at all. Or, you should at least be able to prove to yourself that you can’t get there, even if it’s hard to convince the compiler (that’s one reasonable case for <code class=highlighter-rouge>Debug.crash</code> in production code). However, in this case we can do neither. It’s perfectly possible to call the function with a mis-match between the <code class=highlighter-rouge>PersonId</code> and the <code class=highlighter-rouge>Activity</code>, so we have to figure out what answer to give in that case.</p><p>You might be thinking that it would be perfectly reasonable to answer <code class=highlighter-rouge>False</code> instead of using <code class=highlighter-rouge>Debug.crash</code>. After all, a <code class=highlighter-rouge>Mother</code> presumably doesn’t have a pending <code class=highlighter-rouge>ChildActivity</code>. Yet there are a couple of problems with this. Calling the function with these mis-matched parameters presumably indicates a bug of some kind in your program logic. It would be better to prevent this bug with appropriately designed types, rather than acting as though there were some reasonable way to continue. Furthermore, what happens if you apply a <code class=highlighter-rouge>not</code> to the result of calling <code class=highlighter-rouge>hasPendingActivity</code>? All of a sudden, it doesn’t seem so reasonable to have returned <code class=highlighter-rouge>False</code> to a non-sensical question.</p><p>Now, I suppose one option to deal with this would be to change the signature of <code class=highlighter-rouge>hasPendingActivity</code> to return a <code class=highlighter-rouge>Maybe</code> (or a <code class=highlighter-rouge>Result</code>)…something like:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>hasPendingActivity</span> <span class=p>:</span> <span class=kt>PersonId</span> <span class=o>-&gt;</span> <span class=kt>Activity</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>Bool</span>
</code></pre></div></div><p>That way, we could return <code class=highlighter-rouge>Nothing</code> in cases where there is a mismatch between our parameters. This would be technically correct at some level, but is really ugly. Perhaps we can do better!</p><h2 id=type-classes>Type Classes</h2><p>What if we conceived of the <code class=highlighter-rouge>Person</code> type not as a “wrapper” for <code class=highlighter-rouge>Child</code> and <code class=highlighter-rouge>Mother</code>, but instead as a set of requirements that we must fulfill in order to deal with a type as a person? In Elm, we could express those requirements in the form of a record, along these lines (with some omissions):</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Person</span> <span class=n>p</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>getAllActivities</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=kt>Activity</span>
        <span class=o>,</span> <span class=n>getAvatarUrl</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>getBirthDate</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>NominalDate</span>
        <span class=o>,</span> <span class=n>getName</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>iconClass</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>String</span>
        <span class=p>}</span>
</code></pre></div></div><p>In effect, we’re saying that any type (here, represented as <code class=highlighter-rouge>p</code>) can be a <code class=highlighter-rouge>Person</code>, so long as you provide an implementation for each of the indicated functions. So, we need to fill in the record for <code class=highlighter-rouge>Child</code> and for <code class=highlighter-rouge>Mother</code>, something like this:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>childPerson</span> <span class=p>:</span> <span class=kt>Person</span> <span class=kt>Child</span>
    <span class=n>childPerson</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>getAllActivities</span> <span class=o>=</span>
            <span class=n>always</span> <span class=o>&lt;|</span>
                <span class=kt>List</span><span class=o>.</span><span class=n>map</span> <span class=kt>ChildActivity</span>
                    <span class=p>[</span> <span class=kt>TakePhoto</span>
                    <span class=o>,</span> <span class=kt>MeasureHeight</span>
                    <span class=o>,</span> <span class=kt>MeasureWeight</span>
                    <span class=p>]</span>
        <span class=o>,</span> <span class=n>getAvatarUrl</span> <span class=o>=</span> <span class=o>.</span><span class=n>avatarUrl</span>
        <span class=o>,</span> <span class=n>getBirthDate</span> <span class=o>=</span> <span class=o>.</span><span class=n>birthDate</span>
        <span class=o>,</span> <span class=n>getName</span> <span class=o>=</span> <span class=o>.</span><span class=n>name</span>
        <span class=o>,</span> <span class=n>iconClass</span> <span class=o>=</span> <span class=n>always</span> <span class=s>"</span><span class=s2>child"</span>
        <span class=p>}</span>


    <span class=n>motherPerson</span> <span class=p>:</span> <span class=kt>Person</span> <span class=kt>Mother</span>
    <span class=n>motherPerson</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>getAllActivities</span> <span class=o>=</span>
            <span class=n>always</span> <span class=o>&lt;|</span>
                <span class=kt>List</span><span class=o>.</span><span class=n>map</span> <span class=kt>MotherActivity</span>
                    <span class=p>[</span> <span class=kt>RecordFamilyPlanningMethod</span>
                    <span class=p>]</span>
        <span class=o>,</span> <span class=n>getAvatarUrl</span> <span class=o>=</span> <span class=o>.</span><span class=n>avatarUrl</span>
        <span class=o>,</span> <span class=n>getBirthDate</span> <span class=o>=</span> <span class=o>.</span><span class=n>birthDate</span>
        <span class=o>,</span> <span class=n>getName</span> <span class=o>=</span> <span class=o>.</span><span class=n>name</span>
        <span class=o>,</span> <span class=n>iconClass</span> <span class=o>=</span> <span class=n>always</span> <span class=s>"</span><span class=s2>mother"</span>
        <span class=p>}</span>
</code></pre></div></div><p>So <code class=highlighter-rouge>Person</code> now describes a class of types (or, perhaps, a “typeclass”) with certain capabilities. If we’re writing a function that needs to make use of one of those capabilities, we no longer have to specify exactly which type it takes. Instead, we can ask for any type that has the capability we need.</p><p>Consider, for instance, a function to view a person. In our first attempt at this, with a tagged type for <code class=highlighter-rouge>Person</code>, a simple version might look something like this.</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>viewPerson</span> <span class=p>:</span> <span class=kt>Person</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewPerson</span> <span class=n>person</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=o>&lt;|</span> <span class=n>getName</span> <span class=n>person</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>getAvatarUrl</span> <span class=n>person</span>
                <span class=o>|&gt;</span> <span class=n>maybeViewImage</span> <span class=p>(</span><span class=n>iconClass</span> <span class=n>person</span><span class=p>)</span>
            <span class=p>]</span>
</code></pre></div></div><p>Using <code class=highlighter-rouge>Person</code> as a typeclass instead would look something like this:<sup id=fnref:haskelldeclaration><a href=#fn:haskelldeclaration class=footnote>4</a></sup></p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>viewPerson</span> <span class=p>:</span> <span class=kt>Person</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewPerson</span> <span class=n>personConfig</span> <span class=n>person</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=o>&lt;|</span> <span class=n>personConfig</span><span class=o>.</span><span class=n>getName</span> <span class=n>person</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>personConfig</span><span class=o>.</span><span class=n>getAvatarUrl</span> <span class=n>person</span>
                <span class=o>|&gt;</span> <span class=n>maybeViewImage</span> <span class=p>(</span><span class=n>personConfig</span><span class=o>.</span><span class=n>iconClass</span> <span class=n>person</span><span class=p>)</span>
            <span class=p>]</span>
</code></pre></div></div><p>This leads to a corresponding difference in how you would call the two functions. In our previous case, assuming you knew you had a <code class=highlighter-rouge>Child</code>, you’d need to wrap it up as a <code class=highlighter-rouge>Person</code>…something like <code class=highlighter-rouge>viewPerson (Child child)</code>. Using typeclasses, you can simply supply the child itself, along with the implementation which allows you to treat a child as a person…something like <code class=highlighter-rouge>viewPerson childPerson child</code>.</p><p>Now, so far, we haven’t actually gained a lot by using <code class=highlighter-rouge>Person</code> as a typeclass instead of a tagged type – it’s just an alternate idiom, so far. The compelling advantage comes when dealing with additional related types. Consider something like <code class=highlighter-rouge>getAllActivities</code> and <code class=highlighter-rouge>hasPendingActivity</code>. Instead of dealing with a wrapped <code class=highlighter-rouge>Activity</code> type, they can now deal directly with the exact type that expresses the activities which are relevant to this kind of person. This can be expressed in Elm as additional type parameters to the <code class=highlighter-rouge>Person</code> record, along these lines:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Person</span> <span class=n>p</span> <span class=n>a</span> <span class=n>id</span> <span class=n>m</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>getAllActivities</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=n>a</span>
        <span class=o>,</span> <span class=n>getAvatarUrl</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>getBirthDate</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>NominalDate</span>
        <span class=o>,</span> <span class=n>getChildren</span> <span class=p>:</span> <span class=n>id</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>List</span> <span class=kt>ChildId</span>
        <span class=o>,</span> <span class=n>getMotherId</span> <span class=p>:</span> <span class=n>id</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Maybe</span> <span class=kt>MotherId</span>
        <span class=o>,</span> <span class=n>getName</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>hasPendingActivity</span> <span class=p>:</span> <span class=n>id</span> <span class=o>-&gt;</span> <span class=n>a</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Bool</span>
        <span class=o>,</span> <span class=n>iconClass</span> <span class=p>:</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>String</span>
        <span class=o>,</span> <span class=n>getMeasurements</span> <span class=p>:</span> <span class=n>id</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=n>m</span>
        <span class=p>}</span>
</code></pre></div></div><p>You might call this a “multi-parameter type class”, if you were so inclined.</p><p>Adding these additional type parameters neatly solves our difficulty with implementing <code class=highlighter-rouge>hasPendingActivity</code>, since we can now depend on getting an activity of the appropriate type – the compiler will complain if we don’t. So, we can do something like:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>motherConfig</span> <span class=p>:</span> <span class=kt>Person</span> <span class=kt>Mother</span> <span class=kt>MotherActivity</span> <span class=kt>MotherId</span> <span class=kt>MotherMeasurements</span>
    <span class=n>motherConfig</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>hasPendingActivity</span> <span class=o>=</span> <span class=n>hasPendingMotherActivity</span>
        <span class=o>,</span> <span class=o>...</span>
        <span class=p>}</span>

    <span class=n>childConfig</span> <span class=p>:</span> <span class=kt>Person</span> <span class=kt>Child</span> <span class=kt>ChildActivity</span> <span class=kt>ChildId</span> <span class=kt>ChildMeasurements</span>
    <span class=n>childConfig</span>
        <span class=p>{</span> <span class=n>hasPendingActivity</span> <span class=o>=</span> <span class=n>hasPendingChildActivity</span>
        <span class=o>,</span> <span class=o>...</span>
        <span class=p>}</span>

    <span class=n>hasPendingChildActivity</span> <span class=p>:</span> <span class=kt>ChildId</span> <span class=o>-&gt;</span> <span class=kt>ChildActivity</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Bool</span>
    <span class=n>hasPendingChildActivity</span> <span class=n>childId</span> <span class=n>childActivity</span> <span class=n>container</span> <span class=o>=</span>
        <span class=o>...</span>

    <span class=n>hasPendingMotherActivity</span> <span class=p>:</span> <span class=kt>MotherId</span> <span class=o>-&gt;</span> <span class=kt>MotherActivity</span> <span class=o>-&gt;</span> <span class=kt>Container</span> <span class=o>-&gt;</span> <span class=kt>Bool</span>
    <span class=n>hasPendingMotherActivity</span> <span class=n>motherId</span> <span class=n>motherActivity</span> <span class=n>container</span> <span class=o>=</span>
        <span class=o>...</span>

</code></pre></div></div><p>There can no longer be any mismatches between the <code class=highlighter-rouge>id</code> and the <code class=highlighter-rouge>activity</code> supplied to <code class=highlighter-rouge>hasPendingActivity</code>, since the compiler is aware of all the related types and will complain if any of them are wrong.</p><p>So, while you might have heard that Elm lacks typeclasses, my own experience is that I use them (at least somewhere) in pretty much every app. You can also find examples of this technique in packages such as <a href=http://package.elm-lang.org/packages/evancz/elm-sortable-table/1.0.1>elm-sortable-table</a>, where the <code class=highlighter-rouge>Config data msg</code> in <code class=highlighter-rouge>view : Config data msg -&gt; State -&gt; List data -&gt; Html msg</code> is a kind of typeclass.</p><p>There are a few limitations of typeclasses in Elm which I should mention. One is that you must explicitly mention the typeclass implementation when you call a function that requires one. So, for instance, to call the <code class=highlighter-rouge>viewPerson</code> function sketched above, you need to explicitly refer to the typeclass…something like <code class=highlighter-rouge>viewPerson childConfig child</code>, or <code class=highlighter-rouge>viewPerson motherConfig mother</code>. In some languages, the compiler can deduce that if you’re supplying a <code class=highlighter-rouge>child</code> to <code class=highlighter-rouge>viewPerson</code>, you must want to use the <code class=highlighter-rouge>childConfig</code>, so you don’t have to mention it explicitly. That is a convenience, but it is often confusing to try to follow the compiler’s reasoning about which typeclass instance it will deduce. It may not be such a terrible thing to just say which one you want. Saying which typeclass you want also makes it easy to construct typeclasses at run-time, which is occasionally handy, and is more convoluted (but not impossible) in languages like Haskell.</p><p>A bigger difficulty is Elm’s lack of higher-kinded polymorphism. What this means is that type parameters cannot be used as wrappers – they can only be wrapped. So, in the example above, we have to be specific about the <u>List</u> in <code class=highlighter-rouge>List p</code>. The <code class=highlighter-rouge>p</code> can be a parameter, but we have to make a definite choice about <code class=highlighter-rouge>List</code> – you must always choose concrete “container” types. So, there are some relationships between types that you won’t be able to model accurately. However, that still leaves a lot of room for this technique to be useful.</p><p>Finally, there are cases in which you really do want a tagged type. Consider a case where you might want to include both children and mothers in the same list.</p><ul><li><p>You can say <code class=highlighter-rouge>List p</code>, but that is either a list of all mothers, or all children, not a list that can include both.</p></li><li><p>You could do something fancy with existential types (or rank-n types), but Elm doesn’t have those.</p></li></ul><p>So, if you need a list that can include both mothers and children, you’re pretty much going to need a tagged type. In our app, it turned out that we didn’t need that for mothers and children, but there were cases in which we wanted lists of activities. So, in addition to the <code class=highlighter-rouge>Person</code> record, we also had a tagged type for activities.</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=kt>Activity</span>
        <span class=o>=</span> <span class=kt>MotherActivity</span> <span class=kt>MotherActivity</span>
        <span class=o>|</span> <span class=kt>ChildActivity</span> <span class=kt>ChildActivity</span>
</code></pre></div></div><p>Once you have that, constructing a <code class=highlighter-rouge>List Activity</code> is straightforward. We also added something to <code class=highlighter-rouge>Person</code> so that we could convert (when necessary) from its generic activity type to the more concrete <code class=highlighter-rouge>Activity</code>, along these lines:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Person</span> <span class=n>p</span> <span class=n>a</span> <span class=n>id</span> <span class=n>m</span> <span class=o>=</span>
        <span class=p>{</span> <span class=o>...</span>
        <span class=o>,</span> <span class=n>wrapActivity</span> <span class=p>:</span> <span class=n>a</span> <span class=o>-&gt;</span> <span class=kt>Activity</span>
        <span class=p>}</span>

    <span class=n>childConfig</span> <span class=p>:</span> <span class=kt>Person</span> <span class=kt>Child</span> <span class=kt>ChildActivity</span> <span class=kt>ChildId</span> <span class=kt>ChildMeasurements</span>
    <span class=n>childConfig</span> <span class=o>=</span>
        <span class=p>{</span> <span class=o>...</span>
        <span class=o>,</span> <span class=n>wrapActivity</span> <span class=o>=</span> <span class=kt>ChildActivity</span>
        <span class=p>}</span>

    <span class=n>motherConfig</span> <span class=p>:</span> <span class=kt>Person</span> <span class=kt>Mother</span> <span class=kt>MotherActivity</span> <span class=kt>MotherId</span> <span class=kt>MotherMeasurements</span>
    <span class=n>motherConfig</span> <span class=o>=</span>
        <span class=p>{</span> <span class=o>...</span>
        <span class=o>,</span> <span class=n>wrapActivity</span> <span class=o>=</span> <span class=kt>MotherActivity</span>
        <span class=p>}</span>
</code></pre></div></div><p>This allows you to use both approaches (tagged types and typeclasses) together, in cases where you need both. However, it is often the case that just one or the other approach is fine on its own.</p><h2 id=just-dont-do-it>Just Don’t Do It</h2><p>A question which may have occurred to some readers by now is whether we have really gained anything by expressing a relationship between <code class=highlighter-rouge>Mother</code> and <code class=highlighter-rouge>Child</code> (whether by tagged types or typeclasses). What if we didn’t bother? What if we just let mothers be mothers and children be children, without bothering with unifying types? After all, when writing Elm code, the right answer to some of our impulses is “just don’t do it” – especially when the impulse is towards greater abstraction.</p><p>Consider the <code class=highlighter-rouge>hasPendingActivity</code> function I’ve sketched above. No matter how we structure things, we still need the more concrete <code class=highlighter-rouge>hasPendingChildActivity</code> and <code class=highlighter-rouge>hasPendingMotherActivity</code> anyway. So, what exactly do we gain by also having the more abstract version at our disposal?</p><p>One way of addressing this question is to look at the <code class=highlighter-rouge>viewPerson</code> function which I sketched out above:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=c1>-- With tagged types</span>
    <span class=n>viewperson</span> <span class=p>:</span> <span class=n>person</span> <span class=o>-&gt;</span> <span class=n>html</span> <span class=n>a</span>
    <span class=n>viewperson</span> <span class=n>person</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=o>&lt;|</span> <span class=n>getname</span> <span class=n>person</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>getavatarurl</span> <span class=n>person</span>
                <span class=o>|&gt;</span> <span class=n>maybeviewimage</span> <span class=p>(</span><span class=n>iconclass</span> <span class=n>person</span><span class=p>)</span>
            <span class=p>]</span>

    <span class=c1>-- With type classes</span>
    <span class=n>viewPerson</span> <span class=p>:</span> <span class=kt>Person</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=n>p</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewPerson</span> <span class=n>personConfig</span> <span class=n>person</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=o>&lt;|</span> <span class=n>personConfig</span><span class=o>.</span><span class=n>getName</span> <span class=n>person</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>personConfig</span><span class=o>.</span><span class=n>getAvatarUrl</span> <span class=n>person</span>
                <span class=o>|&gt;</span> <span class=n>maybeViewImage</span> <span class=p>(</span><span class=n>personConfig</span><span class=o>.</span><span class=n>iconClass</span> <span class=n>person</span><span class=p>)</span>
            <span class=p>]</span>
</code></pre></div></div><p>What if we didn’t have a <code class=highlighter-rouge>Person</code> type at all – just <code class=highlighter-rouge>Mother</code> and <code class=highlighter-rouge>Child</code>. Then, we’d end up with something like this:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>viewMother</span> <span class=p>:</span> <span class=kt>Mother</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewMother</span> <span class=n>mother</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=n>mother</span><span class=o>.</span><span class=n>name</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>maybeViewImage</span> <span class=s>"</span><span class=s2>mother"</span> <span class=n>mother</span><span class=o>.</span><span class=n>avatarUrl</span>
            <span class=p>]</span>

    <span class=n>viewChild</span> <span class=p>:</span> <span class=kt>Child</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewChild</span> <span class=n>child</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=n>child</span><span class=o>.</span><span class=n>name</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>maybeViewImage</span> <span class=s>"</span><span class=s2>child"</span> <span class=n>child</span><span class=o>.</span><span class=n>avatarUrl</span>
            <span class=p>]</span>
</code></pre></div></div><p>I suppose it’s true that we’re repeating ourselves a little bit here. However, if our <code class=highlighter-rouge>view</code> function really were this simple, it would be obviously better to repeat ourselves rather than engage in the complexity of constructing a type class. That is, you wouldn’t want to use type classes to avoid this little bit of repetition – the repetition would be less painful (and, fewer lines of code) than the type classes.</p><p>Of course, in our real app, the <code class=highlighter-rouge>view</code> function was much more complex than this. It’s always difficulty writing about programming techniques that only make sense in the presence of complexity, since it would be tedious, and distracting, to actually provide all the complexity. But, consider the following sort of pseduo-code that is somewhat typical:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>viewMother</span> <span class=p>:</span> <span class=kt>Mother</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewMother</span> <span class=n>mother</span> <span class=o>=</span>
        <span class=k>let</span>
            <span class=n>nameBlock</span> <span class=o>=</span>
                <span class=n>viewName</span> <span class=n>mother</span><span class=o>.</span><span class=n>name</span>

            <span class=n>imageBlock</span> <span class=o>=</span>
                <span class=n>maybeViewImage</span> <span class=s>"</span><span class=s2>mother"</span> <span class=n>mother</span><span class=o>.</span><span class=n>avatarUrl</span>

            <span class=n>part3</span> <span class=o>=</span>
                <span class=o>...</span>

            <span class=n>part4</span> <span class=o>=</span>
                <span class=o>...</span>

            <span class=n>part5</span> <span class=o>=</span>
                <span class=o>...</span>

            <span class=n>part6</span> <span class=o>=</span>
                <span class=o>...</span>
        <span class=k>in</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>nameBlock</span>
            <span class=o>,</span> <span class=n>imageBlock</span>
            <span class=o>,</span> <span class=n>part3</span>
            <span class=o>,</span> <span class=n>part4</span>
            <span class=o>,</span> <span class=n>part5</span>
            <span class=o>,</span> <span class=n>part6</span>
            <span class=p>]</span>
</code></pre></div></div><p>Now, suppose you want to be able to view a <code class=highlighter-rouge>Child</code> in a roughly similar way, while avoiding as much code repetition as is reasonable. One way is to generalize the whole function, using tagged types or type classes (the approaches we’ve considered so far). But that’s not the first technique I’d actually reach for. The first technique I’d reach for is generalizing the <strong>parts</strong> of the function. So, you could imagine something like this for <code class=highlighter-rouge>viewChild</code>:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>viewChild</span> <span class=p>:</span> <span class=kt>Child</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>a</span>
    <span class=n>viewChild</span> <span class=n>child</span> <span class=o>=</span>
        <span class=k>let</span>
            <span class=n>nameBlock</span> <span class=o>=</span>
                <span class=n>viewName</span> <span class=n>child</span><span class=o>.</span><span class=n>name</span>

            <span class=n>imageBlock</span> <span class=o>=</span>
                <span class=n>maybeViewImage</span> <span class=s>"</span><span class=s2>child"</span> <span class=n>child</span><span class=o>.</span><span class=n>avatarUrl</span>

            <span class=n>part3</span> <span class=o>=</span>
                <span class=o>...</span>

            <span class=n>part4</span> <span class=o>=</span>
                <span class=o>...</span>

            <span class=n>part5</span> <span class=o>=</span>
                <span class=o>...</span>

            <span class=n>part6</span> <span class=o>=</span>
                <span class=o>...</span>
        <span class=k>in</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>nameBlock</span>
            <span class=o>,</span> <span class=n>imageBlock</span>
            <span class=o>,</span> <span class=n>part3</span>
            <span class=o>,</span> <span class=n>part4</span>
            <span class=o>,</span> <span class=n>part5</span>
            <span class=o>,</span> <span class=n>part6</span>
            <span class=p>]</span>
</code></pre></div></div><p>Here, we’re identifying multiple “helper” functions, like <code class=highlighter-rouge>viewName</code> and <code class=highlighter-rouge>maybeViewImage</code>, which we can re-use <strong>inside</strong> our two distinct functions, rather than trying to create a single, master function. Now, this does leave some repetition in <code class=highlighter-rouge>viewChild</code> and <code class=highlighter-rouge>viewMother</code>. However, the guts of the logic is not repeated, since it is broken out into multiple functions that both <code class=highlighter-rouge>viewChild</code> and <code class=highlighter-rouge>viewMother</code> can call. Depending on what kind of computation goes into <code class=highlighter-rouge>part3</code>, <code class=highlighter-rouge>part4</code>, <code class=highlighter-rouge>part5</code> and <code class=highlighter-rouge>part6</code>, we may have many more opportunities to create additional helper functions.</p><p>Why is this often a preferable approach? One reason is that the helper functions often make a great deal of sense in their own right – you’d probably want to create them anyway. One of the main questions I ask myself when structuring code is: how can I structure this in a way that I can be confident that it’s finished – that I won’t have to revisit it? That is a lot easier to do for <code class=highlighter-rouge>viewNameBlock</code> than it is for <code class=highlighter-rouge>viewMother</code>. Well, I suppose you might want to change the way the name is viewed at some point. But it’s a small, well-defined function that you may be able to just leave alone for quite a while. That’s the kind of function I like.</p><p>The other reason is that the similarities between <code class=highlighter-rouge>viewChild</code> and <code class=highlighter-rouge>viewMother</code> may not be as profound as you initially thought. What if the product manager comes back to you tomorrow, humble developer, and says that children ought to be viewed in a subtly different way than mothers? (They are known to do such things). If you’ve created a <code class=highlighter-rouge>viewPerson</code> function that handles both mothers and children, you can deal with that by creating some sort of configuration in your <code class=highlighter-rouge>Person</code> type – for instance, something like the <code class=highlighter-rouge>iconClass</code> I use above. However, if you have to do too much of that, your <code class=highlighter-rouge>viewPerson</code> function can become convoluted and tricky to understand. It might have been better to break out a bunch of helper functions, so that you can make more comprehensible changes in separate <code class=highlighter-rouge>viewChild</code> and <code class=highlighter-rouge>viewMother</code> functions.</p><p>Now, in the case of the app I was working on, I was pretty confident that the view for children was going to stay structurally similar to the view for mothers, as we continued to develop the app. So, it seemed worthwhile to construct a unified <code class=highlighter-rouge>viewPerson</code> function using type classes. But, you can never be entirely sure – you have to rely on an intuition as to which techniques best fit which situation. After all, you can’t really sketch out each approach in detail and see which is actually nicer – it would take too long! (Unless you’re writing a blog post!). Instead, you need to think about the app’s requirements now, and what they are likely to become, and make the best choice you can.</p><h2 id=extensible-records>Extensible Records</h2><p>Finally, I should at least mention one option which wasn’t suitable for our example, but which could be interesting in some cases: extensible records.</p><p>When you have two related types that are both “record” types, and they share some field definitions in common, it is possible to use Elm’s record syntax to work with just those fields. Consider a <code class=highlighter-rouge>getName</code> function which we want to use with both <code class=highlighter-rouge>Mother</code> and <code class=highlighter-rouge>Child</code>. Both types have a field defined as <code class=highlighter-rouge>name : String</code>. So, we could define a <code class=highlighter-rouge>getName</code> function like this:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>getName</span> <span class=p>:</span> <span class=p>{</span> <span class=n>a</span> <span class=o>|</span> <span class=n>name</span> <span class=p>:</span> <span class=kt>String</span> <span class=p>}</span> <span class=o>-&gt;</span> <span class=kt>String</span>
    <span class=n>getName</span> <span class=n>thingWithAName</span> <span class=o>=</span>
        <span class=n>thingWithAName</span><span class=o>.</span><span class=n>name</span>

    <span class=c1>-- Or, more succintly</span>
    <span class=n>getName2</span> <span class=p>:</span> <span class=p>{</span> <span class=n>a</span> <span class=o>|</span> <span class=n>name</span> <span class=p>:</span> <span class=kt>String</span> <span class=p>}</span> <span class=o>-&gt;</span> <span class=kt>String</span>
    <span class=n>getName2</span> <span class=o>=</span>
        <span class=o>.</span><span class=n>name</span>
</code></pre></div></div><p>Either of those functions can be called with a <code class=highlighter-rouge>Mother</code> or a <code class=highlighter-rouge>Child</code>, because both a <code class=highlighter-rouge>Mother</code> and a <code class=highlighter-rouge>Child</code> have the required <code class=highlighter-rouge>name</code> field. (The <code class=highlighter-rouge>a</code> type parameter tells the compiler that the argument can have other fields as well, in addition to <code class=highlighter-rouge>name</code>).</p><p>Now, as <code class=highlighter-rouge>getName2</code> suggests, you don’t really even need to define <code class=highlighter-rouge>getName</code>, since Elm will magically build it for you if you say <code class=highlighter-rouge>.name</code>. But, this can get more interesting where two types share multiple fields. It becomes possible to define a type that expresses all the fields that the two types have in common. For instance, you could imagine a <code class=highlighter-rouge>Person</code> type that contains the fields that <code class=highlighter-rouge>Child</code> and <code class=highlighter-rouge>Mother</code> have in common:</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=k>type</span> <span class=k>alias</span> <span class=kt>Person</span> <span class=n>a</span> <span class=o>=</span>
        <span class=p>{</span> <span class=n>a</span>
            <span class=o>|</span> <span class=n>name</span> <span class=p>:</span> <span class=kt>String</span>
            <span class=o>,</span> <span class=n>avatarUrl</span> <span class=p>:</span> <span class=kt>Maybe</span> <span class=kt>String</span>
            <span class=o>,</span> <span class=n>birthDate</span> <span class=p>:</span> <span class=kt>NominalDate</span>
        <span class=p>}</span>
</code></pre></div></div><p>Then, you could almost write the simplest version of our <code class=highlighter-rouge>viewPerson</code> function in a way that will accept either a <code class=highlighter-rouge>Child</code> or a <code class=highlighter-rouge>Mother</code> as an argument.</p><div class="language-elm highlighter-rouge"><div class=highlight><pre class=highlight><code>    <span class=n>viewPerson</span> <span class=p>:</span> <span class=kt>Person</span> <span class=n>a</span> <span class=o>-&gt;</span> <span class=kt>Html</span> <span class=n>b</span>
    <span class=n>viewPerson</span> <span class=n>person</span> <span class=o>=</span>
        <span class=n>div</span> <span class=p>[]</span>
            <span class=p>[</span> <span class=n>h4</span> <span class=p>[]</span> <span class=p>[</span> <span class=n>text</span> <span class=n>person</span><span class=o>.</span><span class=n>name</span> <span class=p>]</span>
            <span class=o>,</span> <span class=n>maybeViewImage</span> <span class=s>"</span><span class=s2>?"</span> <span class=n>person</span><span class=o>.</span><span class=n>avatarUrl</span>
            <span class=p>]</span>
</code></pre></div></div><p>This can be a useful technique in simple cases. However, even our simplest version of <code class=highlighter-rouge>viewPerson</code> isn’t quite simple enough. We want to associate a different <code class=highlighter-rouge>iconClass</code> with mothers and children, for use in <code class=highlighter-rouge>maybeViewIamge</code>. Extensible records don’t, by themselves, provide a mechanism for doing that. So, you’ll often need more complex techniques than extensible records. However, in cases where extensible records are sufficient, they are very convenient.</p><h2 id=notes>Notes</h2><div class=footnotes><ol><li id=fn:nofathers><p>There were no fathers in our app’s data model. <a href=#fnref:nofathers class=reversefootnote>&#8617;</a></p></li><li id=fn:singleton><p>You might think it odd that the <code class=highlighter-rouge>MotherMeasurements</code> and <code class=highlighter-rouge>MotherActivty</code> types have just one alternative (<code class=highlighter-rouge>familyPlanningMethod</code> and <code class=highlighter-rouge>RecordFamilyPlanningMethod</code> respectively). The explanation is that they could eventually have more, so it was nice to start with a structure that would accommodate that. <a href=#fnref:singleton class=reversefootnote>&#8617;</a></p></li><li id=fn:tagsandtypes><p>Elm can distinguish tags from the types by context, so you can re-use the type names as tag names if you like. This is what we do with <code class=highlighter-rouge>Mother Mother</code>, where the first <code class=highlighter-rouge>Mother</code> is a tag and the second <code class=highlighter-rouge>Mother</code> is a type. Or, you can invent arbitrary tags. This is necessary for <code class=highlighter-rouge>PersonIdMother MotherId</code> – we can’t just say <code class=highlighter-rouge>MotherId MotherId</code> because we’ve already used <code class=highlighter-rouge>MotherId</code> as a tag when we defined <code class=highlighter-rouge>type MotherId = MotherId Int</code>. At least, we can’t do it in the same module, since the two uses of <code class=highlighter-rouge>MotherId</code> as a tag would clash. <a href=#fnref:tagsandtypes class=reversefootnote>&#8617;</a></p></li><li id=fn:haskelldeclaration><p>If you happen to be familiar with languages like Haskell which have explicit support for typeclasses, the declaration of this kind of function wouldn’t actually look much different. Instead of <code class=highlighter-rouge>viewPerson : Person p -&gt; p -&gt; Html a</code>, you’d have something like <code class=highlighter-rouge>viewPerson :: Person p =&gt; p -&gt; Html a</code>. <a href=#fnref:haskelldeclaration class=reversefootnote>&#8617;</a></p></li></ol></div></div></div><div class="twelve wide column computer only"><div class="ui borderless secondary menu"><a class=item href="/content/prototype-with-css-grid/"><i class="chevron left icon"></i> Walking the Tightrope without a Net: Prototyping in Browser with CSS Grid</a><div class="right menu"><a class=item href="/content/travis-speed/">Travis - The Need for Speed <i class="chevron right icon"></i></a></div></div></div><div class="twelve wide column"><div class="ui segment basic"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><footer class="ui black inverted vertical footer segment padded"><div class="ui center aligned container"><div class="ui three column stackable inverted grid"><div class=column><address><div class=strong>Israel Headquarters</div><div>5 Brenner Street, Tel Aviv</div><a class=telephone href=tel:+97233731222>+972-3-3731222</a> // <a class=email href=mailto:info@gizra.com>info@gizra.com</a></address></div><div class="column icons"><a target=_blank href=https://twitter.com/gizra_drupal><i class="twitter huge icon"></i></a> <a target=_blank href=https://github.com/Gizra/gizra.com><i class="github huge icon"></i></a></div><div class=column><address><div class=strong>North America Office</div><div>350 N. Orleans Street, Suite 9000N, Chicago, IL 60654</div><a class=telephone href=tel:+13125857625>312-585-7625</a> // <a class=email href=mailto:usoffice@gizra.com>usoffice@gizra.com</a></address></div></div></div></footer></div><script src=/bower_components/anchor-js/anchor.min.js></script><script src=/assets/javascript/script.js></script></body></html>