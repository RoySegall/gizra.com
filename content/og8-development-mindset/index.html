<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      
    

<title>OG8 Development Mindset</title>


      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
      <meta content="Gizra" property="og:site_name">

      
        <meta content="OG8 Development Mindset" property="og:title">
      

      

      
      <meta name="http://www.gizra.com/assets/images/posts/og8-development-mindset/thumb.jpg" name="og:image">
      

      <!-- Favicon for all platforms -->
      <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.4fe6.png">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.c391.png" sizes="32x32">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.2d07.png" sizes="194x194">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.8557.png" sizes="96x96">
      <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.8b66.png" sizes="192x192">
      <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.a93c.png" sizes="16x16">
      <link rel="manifest" href="/images/favicons/manifest.json">
      <meta name="msapplication-TileColor" content="#000000">
      <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
      <meta name="theme-color" content="#ffffff">
      <!-- End favicon for all platforms -->

      <link rel="stylesheet" href="/css/main.e27e.css"/>
      <link href='http://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Hind:400,600,300,500' rel='stylesheet' type='text/css'>
      <link href='https://fonts.googleapis.com/css?family=Raleway:400,300,600,800' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
      <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


      <!-- Begin Inspectlet Embed Code -->
      <script type="text/javascript" id="inspectletjs">
      window.__insp = window.__insp || [];
      __insp.push(['wid', 314054580]);
      (function() {
      function ldinsp(){if(typeof window.__inspld != "undefined") return; window.__inspld = 1; var insp = document.createElement('script'); insp.type = 'text/javascript'; insp.async = true; insp.id = "inspsync"; insp.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://cdn.inspectlet.com/inspectlet.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(insp, x); };
      setTimeout(ldinsp, 500); document.readyState != "complete" ? (window.attachEvent ? window.attachEvent('onload', ldinsp) : window.addEventListener('load', ldinsp, false)) : ldinsp();
      })();
      </script>
      <!-- End Inspectlet Embed Code -->

    </head>
    <body>

    <!-- Main content -->
    
  



  
    
      
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  


<header id="header-global">
  <div class="container">
    <div class="row">
      <div class="col-sm-12">
        
  

<span class="gizra-logo"><a href="/">gizra</a></span>
<h1 class="sr-only">Gizra</h1>
<nav id="nav" role="navigation" class="navbar navbar-default">
  <div class="navbar-header">
    <button data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" type="button">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
  </div>
  <div class="navbar-collapse collapse">
    <ul class="nav navbar-nav">
      <li><a href="/#about" class="smooth-scroll-to">About</a></li>
      <li><a href="/services">Our Work</a></li>
      <li><a href="/team">Team</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/fit">Do We Fit?</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>
  </div>
</nav>

      </div>
    </div>
  </div>
</header>
<article id="post-page">
  <div class="container">
    <div class="row">
      <div id="post-title" class="col-sm-10 col-sm-offset-1">
        <h1><a href="/content/og8-development-mindset">OG8 Development Mindset </a></h1>
        <div class="post-author">By Amitai Burstein</div>
      </div>
    </div>
    <div class="row">
      <div id="post-data" class="col-sm-2 col-sm-offset-1">
  			<div id="post-label">
  		 		<a href="/blog"><span class="label label-default">Gizra Blog</span></a>
  			</div>
        <div class="date">07 Sep 2016</div>
        <section class="author-details">
          <div class="image-wrapper">
            <img src="/images/team/avatars/amitaibu.a340.jpg" class="img-circle img-responsive">
          </div>
          <div class="text-wrapper">
            <span class="name">Amitai Burstein</span>
            
              <span class="twitter">(@amitaibu)</span>
            
            <div class="title">CTO, Co-Owner</div>
            <div class="bio">Maintainer of Organic groups, the Message stack, and co-maintainer of Drupal 8's Entity reference. <a href="/content/the-about-story/">The about story</a>.</div>
          </div>
        </section>
        <div class="tags">
          <div class="title">Tags:</div>
          
            <ul class="inline">
              
              

  
    
      <li><a href="/tags.html#Drupal-planet-ref">Drupal-planet</a></li>
    
      <li><a href="/tags.html#Organic Groups-ref">Organic Groups</a></li>
    
  


            </ul>
          
        </div>
      </div>
      <div id="post-content" class="col-sm-8">

        <p>As OG8 is steadily being built, I have noticed a certain pattern - or a mindset - we&rsquo;ve been following which I think is worth sharing.</p>

<p>OG8 is the third time I&rsquo;ve written OG for Drupal. The first OG7 version was a head jump into the Entity goodness that Drupal 7 brought along with Entity API. The second version was taking a small step back away from the Entity fiesta, but took two steps forward into the field API.</p>

<p>I think that as a developer I have matured since then. Edge cases are no longer my concern. I mean, I&rsquo;m making sure that edge cases can be done and the API will cater to it, but I won&rsquo;t go too far and implement them. It&rsquo;s not that in OG7 we tried to tackle all of the edge cases, but in OG8 it&rsquo;s even less.</p>

<p>In fact, although we write a lot of new code as part of the porting, as the way we write modules for Drupal 8 has changed considerably, writing OG8 feels like&hellip; Well, it feels like I&rsquo;m mostly <em>deleting</em> files.</p>

<div class="thumbnail">
  <div class="img-wrapper">

    

    
      <img src="http://www.gizra.com/assets/images/posts/og8-development-mindset/image1.jpg">
    

  </div>
  
    <div class="caption">Removing lines of code is so much better than adding</div>
  
</div>

<h2>Myths Debunked</h2>

<p>It&rsquo;s not too rare to hear rants about OG. Often they are not backed by actual data, or even refer to older versions.  </p>

<!-- more -->

<p>I was even quite surprised to find out in one of DrupalCon BOFs that an &ldquo;OG alternative&rdquo; module (that now seems to be without any much activity for the past year) was created by an author that never bothered to check OG 7.x-2.x. They knew OG 6 and kind of knew OG 7.x-1.x, and yet they used to bash OG pretty badly.</p>

<p>(And just to prevent any mistake, but still not call out the module by name - I am not referring to the Group module. The above section is about another module. You can read about my positive and negative <a href="http://www.gizra.com/content/og-message-stack-drupal8/">critique of Group here</a>.)</p>

<p>Being in that BOF was both funny, and a little sad at the same time.</p>

<p>Now, don&rsquo;t get me wrong. There&rsquo;s nothing bad with alternatives. In fact Message and RESTful modules have grown as alternatives to existing solutions, but they all grew after a deep understanding of all the existing solutions.</p>

<p>So, just for the fun, here are the rants ordered by popularity:</p>

<blockquote>
<p>OG is complicated</p>
</blockquote>

<p>It is. After all, it&rsquo;s dealing with a complicated problem. Just like many other important contrib modules, it does the heavy lifting so that you and I won&rsquo;t have to do it when we build our sites. OG is dealing mostly with access - so no easy shortcuts can be taken.</p>

<p>With that said, the concept itself along with the implementation is quite easy to explain. In fact, in OG8 we&rsquo;ve simplified it even more. That is, we&rsquo;ve somewhat reduced the flexibility in order to reduce the complexity; but while doing so, made sure edge cases can still hook into the process.</p>

<p>I always find that doing sketches by hand, can show that ideas are actually easier then what they might seem. Here&rsquo;s OG in free hand format:</p>

<div class="thumbnail">
  <div class="img-wrapper">

    

    
      <img src="http://www.gizra.com/assets/images/posts/og8-development-mindset/image2.jpg">
    

  </div>
  
    <div class="caption">Concepts should be expressed as easily as possible. Circles made with a small glass, and straight lines with a business card that was on my desk</div>
  
</div>

<p>Seriously, I can&rsquo;t think of a simpler solution that will still allow a robust group site:</p>

<ol>
<li>The reference between a group content to a group is done by core&rsquo;s entity reference.</li>
<li>The reference between a user and a group is done by the <code>OgMembership</code> entity, that can hold aside from the association, also metadata such as the created time and the state of the membership (active, pending, or blocked).</li>
<li>An <code>OgMembership</code> can also reference an <code>OgRole</code>, which is a role that applies inside the group.</li>
</ol>

<blockquote>
<p>OG adds a lot of overhead</p>
</blockquote>

<p>I used Blackfire.io to check the performance of a clean Drupal 8 installation with 1000 users and 5000 nodes. Then I ran the same test on the nodes being also an OG &ldquo;group&rdquo; (i.e. OG uses it as the &ldquo;container&rdquo; of other &ldquo;group content&rdquo;). Profiling was done on an out of the box <code>Basic page</code> node view. When OG was enabled, it was tested with a user that had 15 groups (which is more than the typical use case).</p>

<table><thead>
<tr>
<th></th>
<th>Clean Drupal</th>
<th>Drupal with OG</th>
<th>Difference</th>
</tr>
</thead><tbody>
<tr>
<td>Time</td>
<td>440 ms</td>
<td>468 ms</td>
<td>+28.3 ms (+6.43%)</td>
</tr>
<tr>
<td>I/O Wait</td>
<td>21.1 ms</td>
<td>21.1 ms</td>
<td>+44.2 µs (+0.21%)</td>
</tr>
<tr>
<td>CPU Time</td>
<td>419 ms</td>
<td>447 ms</td>
<td>+28.2 ms (+6.74%)</td>
</tr>
<tr>
<td>Memory</td>
<td>36.5 MB</td>
<td>39.5 MB</td>
<td>+2.98 MB (+8.16%)</td>
</tr>
</tbody></table>

<p>The gist of it: OG added merely 28 ms to the request, and 3 MB more in memory. And for the record, we have not started doing optimizations yet!</p>

<blockquote>
<p>Module X is much [ simpler | faster | betterer | awesomer ]</p>
</blockquote>

<p>Does that module work for you, and you are happy with it? Is it well tested and the maintainer does a good job?</p>

<p>Awesome, stay with that module. OG is just a tool - not a life choice :)</p>

<h2>Correctness</h2>

<p>I have a healthy obsession over quality and the idea of &ldquo;correctness.&rdquo; How can you move forward quickly with your software, but have enough guarantees that you are not breaking existing code. Since PHP is lacking a compiler, it leaves us with a few other good options.</p>

<h3>Data integrity</h3>

<p>Here&rsquo;s one of my favorite images, a Drupal 8 developer sees on a daily basis.</p>

<div class="thumbnail">
  <div class="img-wrapper">

    

    
      <img src="http://www.gizra.com/assets/images/posts/og8-development-mindset/exception.jpg">
    

  </div>
  
    <div class="caption">Better have an error than wrong data</div>
  
</div>

<p>It&rsquo;s an exception thrown by code that was not satisfied with the data it received. It&rsquo;s not a notice, appearing in a red box on top of your page, which your brain has learned to ignore. It&rsquo;s an &ldquo;in your face&rdquo; error message that makes sure you stop being lazy, and go fix your code.</p>

<p>OG8 is applying this same approach. Are you trying to create an OG permission with illegal value? Sorry, this won&rsquo;t work, and we make sure you know about it. Silent errors are risky and can be easily overlooked and pushed to production.<br>
Are you trying to save an OG membership for an anonymous user? Once again, we will throw an exception. This will make sure you won&rsquo;t have a security issue, where suddenly anonymous users might get too much access on your site.</p>

<h3>Automatic Testing</h3>

<p>As good as exceptions are, they are just safeguards. Tests are what will make you and I sleep better at night. But of course, this really depends on the quality and quantity of your tests.</p>

<p>If I would tell you that OG8 has about 50 files, you might refer me to the &ldquo;OG is complicated&rdquo; section above, and gently imply that it sounds like a lot of files.</p>

<p>But sorry, I lied, as in fact OG8 has currently 120 files. However, 50 of those files are under the <code>tests</code> folder.</p>

<p>You see, OG, like any other good module out there has the life above the surface and below the surface. As a site builder or a dev you interact with that part. But the side below is responsible for asserting that we are not breaking the existing functionality or open up security holes. That&rsquo;s the side we - the OG developers - interact with locally or on Travis-CI.</p>

<p>As you can imagine, this is very time consuming. In fact, it&rsquo;s not rare that developing the tests can take more time than the actual code. Just Look at this example: the <a href="https://github.com/Gizra/og/blob/6bc7a861cdc5ded1b77c717a5397af0dabdd6345/src/Controller/SubscriptionController.php#L146-L177">unsubscribe</a> controller, responsible for checking if a user can unsubscribe from a group is about 15 LOC (lines of code). The <a href="https://github.com/Gizra/og/blob/6bc7a861cdc5ded1b77c717a5397af0dabdd6345/tests/src/Unit/SubscriptionControllerTest.php">unit test</a> that covers this method has 230 LOC. In fact it&rsquo;s even not the only test that covers this functionality, as there is also a <a href="https://github.com/Gizra/og/blob/6bc7a861cdc5ded1b77c717a5397af0dabdd6345/tests/src/Functional/GroupSubscribeTest.php">Functional</a> test to assert it.</p>

<p>That&rsquo;s a lot of tests! And even though it&rsquo;s time consuming, it actually allows us to move fast and save time in the long run. Because when you have the confidence that the system is well tested, you are not afraid to continuously iterate, rewrite, and polish existing work.</p>

<p>I think there is another hidden merit in tests. By taking the time to carefully go over your own code - and using it - you give yourself some pause to think about the necessity of your recently added code. Do you <em>really</em> need it? If you are not afraid of writing code and then throwing it out the window, and you are true to yourself, you can create a better, less complex, and polished module.</p>

<h2>Simplifying and hiding advanced features</h2>

<p>One of the mistakes that I feel made in OG7 was exposing a lot of the advanced functionality in the UI. It&rsquo;s not a terrible mistake (ponder on the amount of complex stuff Views UI allows you to do), but I think that it contributed to feeling people had that things are complex.</p>

<p>This notorious administration page allowed you to add OG related fields to different entities. It also allowed you to add different field instances of the same type, as for example you can have multiple OG audience fields on the same bundle.</p>

<div class="thumbnail">
  <div class="img-wrapper">

    

    
      <img src="http://www.gizra.com/assets/images/posts/og8-development-mindset/image3.jpg">
    

  </div>
  
    <div class="caption">Don&rsquo;t worry kids, the beast is gone.</div>
  
</div>

<p>But these are all advanced use cases. When thinking about how to port them to OG8, I think found the perfect solution: we did&rsquo;t port it. It might sound a bit funny, but I think there are important advantages in doing so:</p>

<ol>
<li>Less code to write and maintain.</li>
<li>Less complexity in the system.</li>
<li>Lower the barrier for site builders. They will have just a single page to set a bundle as related to OG.</li>
</ol>

<div class="thumbnail">
  <div class="img-wrapper">

    

    
      <img src="http://www.gizra.com/assets/images/posts/og8-development-mindset/image4.jpg">
    

  </div>
  
    <div class="caption">Adding any OG related field will be done via a simple UI</div>
  
</div>

<p>Obviously, the more advanced features (such as the above-mentioned multiple OG audience fields) remain in the code, so advanced developers can use them when needed via code:</p>
<div class="highlight"><pre><code class="php language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">// Make an bundle a &quot;group&quot;</span>
<span class="nx">\Drupal\og\Og</span><span class="o">::</span><span class="na">addGroup</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">);</span>

<span class="c1">// Add OG audience field to a &quot;group content&quot;</span>
<span class="nx">\Drupal\og\Og</span><span class="o">::</span><span class="na">createField</span><span class="p">(</span><span class="nx">\Drupal\og\OgGroupAudienceHelper</span><span class="o">::</span><span class="na">DEFAULT_FIELD</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;article&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Excited? So are we! Come and <a href="https://github.com/Gizra/og">join us</a>, we have low-hanging-fruit issues you can start with, and you&rsquo;ll find yourself writing features and tests in no time!</p>


      </div>
    </div>
  </div>
</article>
<section id="post-nav">
  <div class="container">
    <div class="row">
      <div class="col-sm-3 col-sm-offset-3 col-xs-6 previous">
        
        <a href="/content/getting-started-with-drupal-core-initiative">
          <div id="previous-label" class="text-small">
            <span class="hidden-xs"><i class="fa fa-chevron-circle-left"></i>&nbsp;Getting started with a Core Initiative</span>
            <span class="visible-xs"><i class="fa fa-chevron-circle-left"></i>&nbsp;Previous post</span>
          </div>
        </a>
        
      </div>
      <div class="col-sm-3 col-sm-offset-2 col-xs-6 next">
        
        <a href="/content/dynamic-email-template">
          <div id="next-label" class="text-small">
            <span class="hidden-xs">Creating a Dynamic Email Template in Drupal&nbsp;<i class="fa fa-chevron-circle-right"></i></span>
            <span class="visible-xs">Next post&nbsp;<i class="fa fa-chevron-circle-right"></i></span>
          </div>
        </a>
        
      </div>
    </div>
  </div>
</section>
<section>
  <div class="container">
    <div class="row">
      <div class="col-sm-8 col-sm-offset-3">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </div>
    </div>
  </div>
</section>
    


    <!--Footer -->
    
  <div id="contact">
    <footer id="footer" role="contentinfo">
      <div class="footer-wrapper">
        <div class="background">
          <div class="container">
            <div class="row">
              <div class="col-sm-12">
                <h2 class="title">Talk to us</h2>
                <div class="clearfix">
                  <address>
                    <div class="strong">Israel Headquarters</div>
                    <span>5 Brenner Street, Tel Aviv</span>
                      <a class="telephone" href="tel:+97233731222">+972-3-3731222</a>
                    <a class="email" href="mailto:info@gizra.com">info@gizra.com</a>
                  </address>
                  <address class="separator">
                    <div class="strong">North America Office</div>
                    <span>106 West 32nd Street, 2nd Floor, New York, NY 10001</span>
                    <a class="telephone" href="tel:+13476864508">212-634-1687</a>
                    <a class="email" href="mailto:usoffice@gizra.com">usoffice@gizra.com</a>
                  </address>
                  <div class="separator social-links">
                    <span class="link github">
                      <a href="https://github.com/Gizra" target="_blank"><i class="fa fa-github-square"></i><span class="link-text">Gizra's Github Account</span></a>
                    </span>
                    <span class="link twitter">
                      <a href="https://twitter.com/gizra_drupal" target="_blank"><i class="fa fa-twitter-square"></i><span class="link-text">Gizra's Twitter Account</span></a>
                    </span>
                    <span class="link linkedin">
                      <a href="https://www.linkedin.com/company/gizra-ltd" target="_blank"><i class="fa fa-linkedin-square"></i><span class="link-text">Gizra's LinkedIn Page</span></a>
                    </span>
                    <span class="link facebook">
                      <a href="https://www.facebook.com/gizraltd/timeline" target="_blank"><i class="fa fa-facebook-square"></i><span class="link-text">Gizra's Facebook Page</span></a>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
  </div>



    <script src="/js/plugins.c9ea.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>

    <script src="/js/scripts.f755.js"></script>
    </body>
</html>
