<!DOCTYPE html><html lang=en><head><title>Stress Testing - Go Ahead and Crash Your Site</title><meta name=viewport content="width=device-width,initial-scale=1"><meta property=og:site_name content=Gizra><meta property=og:title content="Stress Testing - Go Ahead and Crash Your Site"><meta name=description content="Using some available tools for website stress testing, let's learn how to crash your site before your visitors do!"><meta property=og:description content="Using some available tools for website stress testing, let's learn how to crash your site before your visitors do!"><meta name=twitter:card content="summary_large_image"/><meta name=twitter:site content="@gizra_drupal"/><meta property=og:image content=https://www.gizra.com/assets/images/posts/stress-testing/thumb.jpg><link rel=apple-touch-icon sizes=180x180 href=/assets/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/assets/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/favicons/favicon-194x194.png sizes=194x194><link rel=icon type=image/png href=/assets/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/assets/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=/assets/favicons/manifest.json><meta name=msapplication-TileColor content=#000000><meta name=msapplication-TileImage content=/assets/favicons/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="https://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Esteban" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:500,700" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css integrity=sha384-370KB8zqOlHxys9dcOyC7aCeXVtGyiKkWkp+cn8Mfoi13/sPj7fvSuhKRRdFbcip crossorigin=anonymous><link rel=stylesheet href="/assets/stylesheets/style.css"/><script src=https://code.jquery.com/jquery-2.2.4.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js integrity=sha384-xfhRYqbW4Asj6UIfXB+Fp7GsmhF9uCf4R+oIGrp7YaBMAmlQWihnvGrW2WbdQRIS crossorigin=anonymous></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');</script></head><body class=pushable><div class="ui sidebar inverted vertical menu left"><a class="item active" href="/">Home</a> <a class=item href=/team>Team</a> <a class=item href=/blog>Blog</a> <a class=item href=/podcast>Podcast</a> <a class=item href=/projects>Projects</a> <a class=item href=/our-story>Our Story</a> <a class=item href=/contact>Contact</a></div><div class=pusher><div class="ui grid container"><header class=row><div class="five wide column menu bar"><div class="ui large secondary menu"><a class="item sidebar-toggle"><i class="big sidebar icon"></i> Menu</a></div></div><div class="six wide computer six wide tablet eleven wide mobile column center aligned"><a class=gizra-logo href="/"><svg version=1.1 width=252 height=104 aria-labelledby="title desc" role=img><title id=title>Gizra Logo</title><desc id=desc>The Gizra Logo</desc><path fill=#E27058 fill-rule=evenodd d="M44.3 21.6c.2 3.5 3 5.4 6 5.4 3.5 0 6.7-2 6.7-7s-3.6-7.7-8.5-7.7c-4.3 0-10.3 2.5-10.3 11 0 1.7.2 3.4.6 5.3-3.4-2-6.5-2.6-11.6-2.6-16 0-22.7 7.6-22.7 17.5 0 8.7 4 13.7 12.2 16-8.2 5-12 7.8-12 13.8C4.7 78 8 83 20.7 83h10c11 0 13.4 2 13.4 7 0 6.7-5.8 11.3-17 11.3s-13.4-4.7-13.4-9c0-1.8.2-3.5 1-5.8l-6.4-3C4.5 84.8.2 87 .2 92c0 6.8 7.5 11.3 25.8 11.3 21.2 0 29.6-8.5 29.6-20 0-14.4-12-17.2-23.8-17.2H21c-5.5 0-6.6-.4-6.6-1.4 0-1 1-2 4.6-4.4 2.2.4 5.4.8 8.5.8C40.3 61 49 55 49 43c0-6.8-4-10.5-8-13.3-.6-2.5-.8-4.6-.8-6.3 0-6.5 3-7 4.5-7 2.2 0 2.8 1.7 2.5 3.4l-3 1.8zM22 41.2C22 29.7 24 28 27 28s4.6 1.4 4.6 13.2v5c0 11-1.8 12.7-4.6 12.7-3.2 0-5-2.3-5-12V41zM62 10c0 4.4 2 9.8 10.6 9.8 7.6 0 10.6-4.3 10.6-10 0-6.3-3.8-9.6-10.4-9.6C65 .2 62 5 62 10zm-5.4 17v2h6.2v46H57v2h31.2v-2h-6V27H56.7zm82.5 0H95l-1.4 20.2H95c4.3-15 8-18.3 22.2-18.3h1L93 75.3V77h44l1.8-21.5h-1.5C133.5 69 127.5 75 115.6 75h-1.4l25-46v-2zm41 3c2.2 0 4.3 1 2.2 5.3h-3.8c-2.2 7.5 1 12 8.2 12 5.6 0 8.8-4 8.8-10 0-8-5-11.3-11.2-11.3-6.3 0-12 3.6-14 11V27H145v2h5.7v46h-5.8v2h32.6v-2h-7.4V47c0-9.5 4.7-17 9.7-17zm40.5 22.3c-15 0-24.2 2.4-24.2 13 0 10.5 8.2 12.8 15.6 12.8 7.2 0 10.3-2.7 12-7.7 1.2 5 6 7.8 14.4 7.8 9 0 13-3.5 13.5-16l-1.7-.2c-.5 8.8-2.3 10.8-4.2 10.8-1.7 0-3-1.2-3-5.5V46c0-15.2-5.5-19.8-22-19.8-14.3 0-22 4-22 13 0 5 2.6 8.6 9 8.6 5.3 0 9.3-3.3 9.3-8.2 0-2-.3-3.4-.8-4.7H214c-.6-1.2-.8-2.2-.8-3 0-3.4 3-4.3 5-4.3 4.2 0 5.3 3.5 5.3 16.8v8h-3zM219 73.8c-2 0-2.7-1-2.7-8.6v-1.6c0-6.4 2-9.6 6.5-9.6h.7v9.8c0 6.7-2.5 10-4.5 10z"/></svg></a><div class=tagline>We Build Websites</div></div><div class="five wide computer only column"></div></header><div class="ui grid centered post"><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column"><div class="ui raised padded segment"><h1 class="ui dividing header"><div class="ui image"><img src=/assets/images/team/avatars/AronNovak.jpg class="ui circular image"></div><div class=content><a href="/content/stress-testing/">Stress Testing - Go Ahead and Crash Your Site</a><div class="sub header">By Áron Novák // 23 Apr 2018</div></div><div class="right floated column"><a href=/blog class="ui teal right ribbon big label">Blog Post</a></div></h1><p>If you’d like to challenge your infrastructure provider, your development team, or you’re simply looking forward to optimizing the scalability of your web application, join us for a short adventure to stress test <a href=https://www.gizra.com>gizra.com</a>.</p><p>At the beginning, we discuss some conceptual lessons learned, so you may jump to the <a href=#how>explanation of the implementation</a> directly .</p><h2 id=who>Who?</h2><p>Who should we trust to perform stress testing? An old player, like <a href="https://jmeter.apache.org/">JMeter</a>? Or newcomers like <a href="https://gatling.io/">Gatling.io</a> or <a href="https://locust.io/">Locust.io</a>?</p><p>We ended up using Gatling.io for our latest stress testing issue. We discarded JMeter, as its UI was hard to understand and it has an XML-based, <a href=https://jmeter.apache.org/demos/ForEachTest2.jmx>not human-friendly</a> file format. There are subtle technical differences in the background related to the connection handling and the overall performance of the test execution; but in our scenario, we were far from the situation that the tool would limit our ability to get realistic picture of the application’s behavior.</p><p>Locust.io, on the other hand, has an expressive language. We started to build tests with it, but when it came to resource processing, variable handling, plugins, it turned out that Gatling.io has a <a href="https://github.com/search?utf8=%E2%9C%93&amp;q=gatling&amp;type=">much broader</a> ecosystem than <a href="https://github.com/search?utf8=%E2%9C%93&amp;q=locust&amp;type=">Locust.io</a>. When you have an actual problem to solve, you are more likely find an example or a solution for Gatling.io. Needless to say, that could change easily in the future.</p><p>The icing on the cake is that Gatling.io provides a framework to write your tests in a functional language - something <a href="https://www.gizra.com/content/selling-item-for-millions-elm-headless-drupal/">we all love</a>!</p><h2 id=what>What?</h2><h3 id=what-is-stress-testing>What is Stress Testing?</h3><p>Stress testing is really not web development specific, you can stress test <a href=https://en.wikipedia.org/wiki/Prime95>your CPU</a>, <a href=https://github.com/jwbensley/EtherateMT>your network</a> and, of course, your website. There are various goals to stress testing:</p><ul><li>Determine the available capacity.</li><li>Understand how the system degrades when it fails to perform perfectly.</li><li>Know when the system becomes totally unavailable.</li></ul><h3 id=what-do-you-want-to-stress-test>What Do You Want to Stress Test?</h3><p>In case of stress testing a website, there is a decision on what precisely to test. For instance you could choose:</p><ul><li>the infrastructure where the given instance of the site is hosted.</li><li>one of the present caching layers (CDN, Drupal page cache, etc.).</li><li>for anonymous visitors or for logged in users.</li><li>with or without executing the front-end code of the website.</li></ul><p>You can mix your set of goals, but during the implementation, you need to pay attention to follow this decision. For instance, if you would like to exclude Varnish cache from the testing, but still, you want Drupal to use page cache, you’ll need to do some tricks, such as setting an invalid session cookie header that prevents Varnish from caching, however allows Drupal to use the page cache as usual.</p><h2 id=when>When?</h2><p>When is it the right time to execute the tests?</p><p>We could just say ‘always’, but the more nuanced answer depends on your application. If it’s mostly for anonymous users, stress-testing it in a production-like environment once, just near the launch seems to be adequate. For systems with lots of logged in users, where the performance can vary a lot from release to release, it would make sense to execute it before each major release.</p><h2 id=where>Where?</h2><p>So you’re at the beginning of your project and it’s critical to provide excellent performance and scalability, then you can integrate Gatling.io into Travis. When your site is bootstrapped, it’s perfectly possible to execute a stress test and define a threshold for the throughput and let Travis fail if the result does not exceed the defined value. Be prepared that this will slightly increase the instability of your Travis builds, as the available resources in the environment that Travis provides are not fully stable, and sometimes there will be sporadic failures. Despite that, it can be a very appealing option to ensure that the performance and the scalability does not degrade during sprints.</p><p>If you would like to perform a test in a production-like environment, Travis won’t tell you if your infrastructure or service provider lags behind its promise. A production-like environment has:</p><ul><li>the same amount of bandwidth as production.</li><li>the same database as production (except with sanitization).</li><li>the same level of hardware resources.</li></ul><p>You can safely ignore that the live site has real users, but your other environment does not, as the stress test will ideally reach the limits of the stack regardless of existing human users.</p><p>Outside of Travis, you might be able to execute the tests from your <code class=highlighter-rouge>local</code> environment, but you can benefit a lot from a hosted service, like <a href="https://www.blazemeter.com/">BlazeMeter</a> (post a comment if you know a better alternative). Why not locally? The service can make sure and can monitor that your test execution is not limited by:</p><ul><li>the available bandwidth.</li><li>the computing resources of the test-executing machine.</li><li>the geographical distance to the target.</li></ul><p>There are these and other factors that affects the realistic execution, and using a hosted service can help you to avoid these pitfalls.</p><h2 id=why>Why?</h2><p>As you’re reading this paragraph, likely you have your own answers. My short answer would be to be able to spot problems before they happen. Such “gotchas” that I’ve seen in the past:</p><ul><li>Under-performing hosting provider.</li><li>Misconfigured Varnish.</li><li>Non-functioning anonymous page cache.</li><li>Non-scalable algorithm in custom/contributed code.</li><li>Insufficient available bandwidth (compared to the static assets on the site and the expected traffic).</li></ul><p>It’s actually an exciting problem-solving game to analyze the output and understand what kind of problems there are, if any.</p><h2 id=how>How?</h2><p><a name=how></a> Now after reading my various thoughts on stress testing, let’s craft one test together against <a href=https://www.gizra.com>Gizra.com</a>.</p><p>You may notice that we use Scala to write the tests. Don’t worry, with all the great <a href="https://gatling.io/docs/current/quickstart/">tutorials</a> and <a href="https://gatling.io/docs/current/cookbook/">examples</a>, no Scala knowledge is needed, a little experience with functional programming will certainly help. Let’s incrementally add new pieces to a small building block together until we have an executable test.</p><h3 id=a-simple-http-request>A Simple HTTP Request</h3><p>To issue a single static HTTP request, it can be as simple as:</p><div class="language-scala highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>val</span> <span class=n>scn</span> <span class=k>=</span> <span class=n>scenario</span><span class=o>(</span><span class=s>"Gizra"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>exec</span><span class=o>(</span><span class=n>http</span><span class=o>(</span><span class=s>"request_0"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>"/blog/"</span><span class=o>)</span>
    <span class=o>)</span>
</code></pre></div></div><p>Here, we issue a single HTTP request at the host, to retrieve the <a href="https://www.gizra.com/blog/">blog page</a>. None of the images, CSS or JS files will be retrieved, just this single URL, nothing else. We will add the base URL handling at a later step.</p><h3 id=headers>Headers</h3><p>Real browsers do send various headers alongside the request, we can make it more realistic this way:_</p><div class="language-scala highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>val</span> <span class=n>httpProtocol</span> <span class=k>=</span> <span class=n>http</span>
  <span class=o>.</span><span class=n>acceptHeader</span><span class=o>(</span><span class=s>"*/*"</span><span class=o>)</span>
  <span class=o>.</span><span class=n>acceptEncodingHeader</span><span class=o>(</span><span class=s>"gzip, deflate"</span><span class=o>)</span>
  <span class=o>.</span><span class=n>acceptLanguageHeader</span><span class=o>(</span><span class=s>"en-US,en;q=0.5"</span><span class=o>)</span>
  <span class=o>.</span><span class=n>doNotTrackHeader</span><span class=o>(</span><span class=s>"1"</span><span class=o>)</span>
  <span class=o>.</span><span class=n>userAgentHeader</span><span class=o>(</span><span class=s>"Mozilla/5.0 (X11; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0"</span><span class=o>)</span>

<span class=k>val</span> <span class=n>headers_0</span> <span class=k>=</span> <span class=nc>Map</span><span class=o>(</span>
  <span class=s>"Accept"</span> <span class=o>-&gt;</span> <span class=s>"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span><span class=o>,</span>
  <span class=s>"Upgrade-Insecure-Requests"</span> <span class=o>-&gt;</span> <span class=s>"1"</span><span class=o>)</span>

<span class=k>val</span> <span class=n>scn</span> <span class=k>=</span> <span class=n>scenario</span><span class=o>(</span><span class=s>"Gizra"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>exec</span><span class=o>(</span><span class=n>http</span><span class=o>(</span><span class=s>"request_0"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>"/blog/"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>headers</span><span class=o>(</span><span class=n>headers_0</span><span class=o>)</span>
    <span class=o>)</span>
</code></pre></div></div><p>We have the ability to define global headers via the <a href="https://gatling.io/docs/2.3/http/http_protocol/">http protocol</a> and also for <a href=https://gatling.io/docs/2.3/http/http_request/#headers>each request</a>. Right now we did not connect the <code class=highlighter-rouge>httpProtocol</code> with our <code class=highlighter-rouge>scn</code> scenario, as it will happen when we define our users.</p><h3 id=dynamic-http-request>Dynamic HTTP Request</h3><p>Let’s say we’d like to simulate a user who arrives to the blog page and visits the first blog entry. Then what is the URL of that first item? It’s only possible to know from the response of the first query. Fortunately, Gatling gives us the ability to parse the result and use it in the next request this way:</p><div class="language-scala highlighter-rouge"><div class=highlight><pre class=highlight><code>  <span class=k>val</span> <span class=n>scn</span> <span class=k>=</span> <span class=n>scenario</span><span class=o>(</span><span class=s>"Gizra"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>exec</span><span class=o>(</span><span class=n>http</span><span class=o>(</span><span class=s>"request_0"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>"/blog/"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>check</span><span class=o>(</span><span class=n>css</span><span class=o>(</span><span class=s>"#blog-page .content:first-of-type a"</span><span class=o>,</span> <span class=s>"href"</span><span class=o>).</span><span class=n>saveAs</span><span class=o>(</span><span class=s>"blogentry"</span><span class=o>))</span>
    <span class=o>)</span>
    <span class=o>.</span><span class=n>exec</span><span class=o>(</span><span class=n>http</span><span class=o>(</span><span class=s>"request_1"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>"${blogentry}"</span><span class=o>)</span>
    <span class=o>)</span>
</code></pre></div></div><p>If you test a web service and you need to use <code class=highlighter-rouge>jsonPath</code> or <code class=highlighter-rouge>xPath</code>, that’s <a href="https://gatling.io/docs/2.3/http/http_check/">doable</a> as well.</p><h3 id=visitors>Visitors</h3><p>Until now, what we have done behaves exactly like a browser-based automated test. In the end, we defined how and what should be downloaded via HTTP requests, indeed using a novel syntax. We have our <code class=highlighter-rouge>httpProtocol</code> and the <code class=highlighter-rouge>scn</code> scenario, we can now ask Gatling to create some users and gradually put more pressure on the site and the infrastructure:</p><div class="language-scala highlighter-rouge"><div class=highlight><pre class=highlight><code>  <span class=n>setUp</span><span class=o>(</span><span class=n>scn</span><span class=o>.</span><span class=n>inject</span><span class=o>(</span>
    <span class=n>rampUsers</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span> <span class=n>over</span><span class=o>(</span><span class=mi>10</span> <span class=n>seconds</span><span class=o>),</span>
  <span class=o>)).</span><span class=n>protocols</span><span class=o>(</span><span class=n>httpProtocol</span><span class=o>)</span>
</code></pre></div></div><p>In this scenario, we ask Gatling - over the course of 10 seconds - to add 10 users. There are many strategies that Gatling can follow when injecting new <a href="https://gatling.io/docs/2.3/general/simulation_setup/">sessions</a> to the simulation.</p><h3 id=a-simulation-class>A Simulation Class</h3><p>Now it’s time to use a bit more from Scala, but actually it does not vary a lot from test to test, so our whole class looks like this:</p><div class="language-scala highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=k>import</span> <span class=nn>scala.concurrent.duration._</span>

<span class=k>import</span> <span class=nn>io.gatling.core.Predef._</span>
<span class=k>import</span> <span class=nn>io.gatling.http.Predef._</span>
<span class=k>import</span> <span class=nn>io.gatling.jdbc.Predef._</span>

<span class=k>class</span> <span class=nc>GizraCom</span> <span class=k>extends</span> <span class=nc>Simulation</span> <span class=o>{</span>
  <span class=k>val</span> <span class=n>testServerUrl</span> <span class=k>=</span> <span class=n>scala</span><span class=o>.</span><span class=n>util</span><span class=o>.</span><span class=nc>Properties</span><span class=o>.</span><span class=n>envOrElse</span><span class=o>(</span><span class=s>"GIZRA_COM_BASE_URL"</span><span class=o>,</span> <span class=s>"https://www.gizra.com"</span><span class=o>)</span>

  <span class=k>val</span> <span class=n>httpProtocol</span> <span class=k>=</span> <span class=n>http</span>
    <span class=o>.</span><span class=n>baseURL</span><span class=o>(</span><span class=n>testServerUrl</span><span class=o>)</span>
    <span class=o>.</span><span class=n>acceptHeader</span><span class=o>(</span><span class=s>"*/*"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>acceptEncodingHeader</span><span class=o>(</span><span class=s>"gzip, deflate"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>acceptLanguageHeader</span><span class=o>(</span><span class=s>"en-US,en;q=0.5"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>doNotTrackHeader</span><span class=o>(</span><span class=s>"1"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>userAgentHeader</span><span class=o>(</span><span class=s>"Mozilla/5.0 (X11; Linux x86_64; rv:58.0) Gecko/20100101 Firefox/58.0"</span><span class=o>)</span>

  <span class=k>val</span> <span class=n>scn</span> <span class=k>=</span> <span class=n>scenario</span><span class=o>(</span><span class=s>"Gizra"</span><span class=o>)</span>
    <span class=o>.</span><span class=n>exec</span><span class=o>(</span><span class=n>http</span><span class=o>(</span><span class=s>"request_0"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>"/blog/"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>check</span><span class=o>(</span><span class=n>css</span><span class=o>(</span><span class=s>"#blog-page .content:first-of-type a"</span><span class=o>,</span> <span class=s>"href"</span><span class=o>).</span><span class=n>saveAs</span><span class=o>(</span><span class=s>"blogentry"</span><span class=o>))</span>
    <span class=o>)</span>
    <span class=o>.</span><span class=n>exec</span><span class=o>(</span><span class=n>http</span><span class=o>(</span><span class=s>"request_1"</span><span class=o>)</span>
      <span class=o>.</span><span class=n>get</span><span class=o>(</span><span class=s>"${blogentry}"</span><span class=o>)</span>
    <span class=o>)</span>

  <span class=n>setUp</span><span class=o>(</span><span class=n>scn</span><span class=o>.</span><span class=n>inject</span><span class=o>(</span>
    <span class=n>rampUsers</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span> <span class=n>over</span><span class=o>(</span><span class=mi>10</span> <span class=n>seconds</span><span class=o>),</span>
  <span class=o>)).</span><span class=n>protocols</span><span class=o>(</span><span class=n>httpProtocol</span><span class=o>)</span>

<span class=o>}</span>
</code></pre></div></div><p>It is convenient for <code class=highlighter-rouge>local</code> execution that you can override the base URL via the <code class=highlighter-rouge>GIZRA_COM_BASE_URL</code> environment variable, so:</p><div class="language-shell highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=nb>export </span><span class=nv>GIZRA_COM_BASE_URL</span><span class=o>=</span><span class=s2>"http://gizra.local"</span>
./run.sh
</code></pre></div></div><p>would test your local instance instead of the <code class=highlighter-rouge>live</code> site For this <code class=highlighter-rouge>run.sh</code>, continue reading.</p><h3 id=execute-it-on-local>Execute it on Local</h3><p>During the implementation of your test, you surely want to execute it locally, a little script can be convenient, especially if you are not alone on your project:</p><div class="language-shell highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=c>#!/bin/bash</span>

<span class=nv>BASE_DIR</span><span class=o>=</span><span class=s2>"</span><span class=k>$(</span> <span class=nb>cd</span> <span class=s2>"</span><span class=k>$(</span> <span class=nb>dirname</span> <span class=s2>"</span><span class=k>${</span><span class=nv>BASH_SOURCE</span><span class=p>[0]</span><span class=k>}</span><span class=s2>"</span> <span class=k>)</span><span class=s2>"</span> <span class=o>&amp;&amp;</span> <span class=nb>pwd</span> <span class=k>)</span><span class=s2>"</span>
<span class=k>if</span> <span class=o>[</span> <span class=o>!</span> <span class=nt>-d</span> <span class=s2>"</span><span class=nv>$BASE_DIR</span><span class=s2>"</span>/gatling-charts-highcharts-bundle-2.3.0 <span class=o>]</span><span class=p>;</span> <span class=k>then
  </span><span class=nb>cd</span> <span class=s2>"</span><span class=nv>$BASE_DIR</span><span class=s2>"</span> <span class=o>||</span> <span class=nb>exit </span>1
  wget https://repo1.maven.org/maven2/io/gatling/highcharts/gatling-charts-highcharts-bundle/2.3.0/gatling-charts-highcharts-bundle-2.3.0-bundle.zip
  unzip gatling-charts-highcharts-bundle-2.3.0-bundle.zip
  <span class=nb>rm </span>gatling-charts-highcharts-bundle-2.3.0-bundle.zip
  <span class=nb>cd </span>gatling-charts-highcharts-bundle-2.3.0 <span class=o>||</span> <span class=nb>exit </span>1
  <span class=nb>ln</span> <span class=nt>-s</span> <span class=s2>"</span><span class=nv>$BASE_DIR</span><span class=s2>"</span>/GizraCom.scala user-files/simulations/
<span class=k>fi
</span><span class=nb>cd</span> <span class=s2>"</span><span class=nv>$BASE_DIR</span><span class=s2>"</span>/gatling-charts-highcharts-bundle-2.3.0 <span class=o>||</span> <span class=nb>exit </span>1
./bin/gatling.sh <span class=nt>-s</span> GizraCom
</code></pre></div></div><p>The HTML report is detailed and ready to show even for business stakeholders, along with your expert insights:</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="https://www.gizra.com/assets/images/posts/stress-testing/report.png"/></div></div><div class="ui attached center aligned caption segment">A report from Gatling.io on Gizra.com.</div></div><h3 id=execute-it-on-blazemeter>Execute It on BlazeMeter</h3><p>Optionally, if you aim for realistic, large-scale executions of this test, we can put it in the cloud. The ingredients here are:</p><ul><li>a (free) BlazeMeter account</li><li>a Taurus configfile, <code class=highlighter-rouge>test.yml</code>:</li></ul><div class="language-yml highlighter-rouge"><div class=highlight><pre class=highlight><code><span class=na>execution</span><span class=pi>:</span>
<span class=pi>-</span> <span class=na>executor</span><span class=pi>:</span> <span class=s>gatling</span>
  <span class=na>scenario</span><span class=pi>:</span> <span class=s>sample</span>

<span class=na>scenarios</span><span class=pi>:</span>
  <span class=na>sample</span><span class=pi>:</span>
    <span class=na>script</span><span class=pi>:</span> <span class=s>GizraCom.scala</span>
    <span class=na>simulation</span><span class=pi>:</span> <span class=s>GizraCom</span>
    <span class=na>keepalive</span><span class=pi>:</span> <span class=no>true</span>
</code></pre></div></div><p>This is needed for BlazeMeter to be able to recognize the Gatling test, it’s fully specific to this service. If you plant execute it only locally, you don’t need it.</p><p>After this, you can upload the simulation files (as Taurus tests), and do a little configuration:</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="https://www.gizra.com/assets/images/posts/stress-testing/blazemeter.png"/></div></div><div class="ui attached center aligned caption segment">File upload and configuration.</div></div><p>And you have even fancier reports than last time - enjoy!</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="https://www.gizra.com/assets/images/posts/stress-testing/blazemeter-report.png"/></div></div><div class="ui attached center aligned caption segment">A BlazeMeter report.</div></div><p>Moreover without extra effort, you can trivially make sure that the test is not bound by the infrastructure:</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="https://www.gizra.com/assets/images/posts/stress-testing/engine-health.png"/></div></div><div class="ui attached center aligned caption segment">BlazeMeter monitors the executor machines for you.</div></div><h3 id=simulation-recorder>Simulation Recorder</h3><p>There is a lazy way to be able to <a href="https://gatling.io/docs/2.3/http/recorder/">record simulation</a> using a GUI, if you just start to experiment with Gatling. Try it out, but for any non-trivial tests, you need to touch the Scala code. For such tests, where you’re interested in downloading a lots of static resources and it would be quite boring to code it manually, give it a shot.</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="https://www.gizra.com/assets/images/posts/stress-testing/recorder.png"/></div></div><div class="ui attached center aligned caption segment">The GUI recorder of Gatling.io - a good companion in writing the actual Scala classes.</div></div><h3 id=icing-on-the-cake---integration-tests-on-travis>Icing on the Cake - Integration Tests on Travis</h3><p>So you just developed a neat, complex stress test suite for your intranet and you have a plan to maintain it alongside your core project. That’s great! Create a tiny <a href=https://github.com/AronNovak/gizra.com-stress-test/blob/master/.travis.yml>Travis integration</a> for the stress test repository, then you can relax: if Travis remains green, the Scala code compiles and the stress test can be executed. If you do it with minimal amount of users, it’s likely acceptable to do it on the production site, so your stress testing repository can have the usual Travis status image as your other repositories.</p><h2 id=takeaway>Takeaway</h2><p>You can access this tiny showcase on <a href=https://github.com/AronNovak/gizra.com-stress-test>GitHub</a>. Fork it, make it a fully-featured boilerplate, make a PR, all are highly appreciated!</p><p>Stress testing has a friendly learning curve if you already have the mindset for browser-based testing. Start today, and you can make commitments to your clients that your site will scale.</p></div></div><div class="twelve wide column computer only"><div class="ui borderless secondary menu"><a class=item href="/content/rebuild-or-refresh/"><i class="chevron left icon"></i> Rebuild or Refresh Your Website: How About Neither?</a><div class="right menu"></div></div></div><div class="twelve wide column"><div class="ui segment basic"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><footer class="ui black inverted vertical footer segment padded"><div class="ui center aligned container"><div class="ui three column stackable inverted grid"><div class=column><address><div class=strong>Israel Headquarters</div><div>5 Brenner Street, Tel Aviv</div><a class=telephone href=tel:+97233731222>+972-3-3731222</a> // <a class=email href=mailto:info@gizra.com>info@gizra.com</a></address></div><div class="column icons"><a target=_blank href=https://twitter.com/gizra_drupal><i class="twitter huge icon"></i></a> <a target=_blank href=https://github.com/Gizra/gizra.com><i class="github huge icon"></i></a></div><div class=column><address><div class=strong>North America Office</div><div>350 N. Orleans Street, Suite 9000N, Chicago, IL 60654</div><a class=telephone href=tel:+13125857625>312-585-7625</a> // <a class=email href=mailto:usoffice@gizra.com>usoffice@gizra.com</a></address></div></div></div></footer></div><script src=/bower_components/anchor-js/anchor.min.js></script><script src=/assets/javascript/script.js></script></body></html>