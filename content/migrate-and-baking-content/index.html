<!DOCTYPE html><html><head><title>Migrate, and baking content</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta property=og:site_name content=Gizra><meta property=og:title content="Migrate, and baking content"><link rel=apple-touch-icon sizes=180x180 href=/assets/favicons/apple-touch-icon-180x180.png><link rel=icon type=image/png href=/assets/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/assets/favicons/favicon-194x194.png sizes=194x194><link rel=icon type=image/png href=/assets/favicons/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/assets/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/assets/favicons/favicon-16x16.png sizes=16x16><link rel=manifest href=/assets/favicons/manifest.json><meta name=msapplication-TileColor content=#000000><meta name=msapplication-TileImage content=/assets/favicons/mstile-144x144.png><meta name=theme-color content=#ffffff><link href="http://fonts.googleapis.com/css?family=Abril+Fatface&text=gizra" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Esteban" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Montserrat:500,700" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.css integrity="sha256-wT6CFc7EKRuf7uyVfi+MQNHUzojuHN2pSw0YWFt2K5E=" crossorigin="anonymous"/><link rel=stylesheet href="/assets/stylesheets/style.css"/><script src=https://code.jquery.com/jquery-2.2.4.min.js integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.7/semantic.min.js integrity="sha256-flVaeawsBV96vCHiLmXn03IRJym7+ZfcLVvUWONCas8=" crossorigin=anonymous></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6558346-3', 'auto');
  ga('send', 'pageview');</script></head><body class=pushable><div class="ui sidebar inverted vertical menu left"><a class="item active" href="/">Home</a> <a class=item href=/team>Team</a> <a class=item href=/blog>Blog</a> <a class=item href=/projects>Projects</a> <a class=item href=/contact>Contact</a></div><div class=pusher><div class="ui grid container"><header class=row><div class="five wide column menu bar"><div class="ui large secondary menu"><a class="item sidebar-toggle"><i class="big sidebar icon"></i> Menu</a></div></div><div class="six wide computer eleven wide tablet column center aligned"><a class=gizra-logo href="/"><svg xmlns=http://www.w3.org/2000/svg width=252 height=104><title>gizra</title><path fill=#E27058 fill-rule=evenodd d="M44.3 21.6c.2 3.5 3 5.4 6 5.4 3.5 0 6.7-2 6.7-7s-3.6-7.7-8.5-7.7c-4.3 0-10.3 2.5-10.3 11 0 1.7.2 3.4.6 5.3-3.4-2-6.5-2.6-11.6-2.6-16 0-22.7 7.6-22.7 17.5 0 8.7 4 13.7 12.2 16-8.2 5-12 7.8-12 13.8C4.7 78 8 83 20.7 83h10c11 0 13.4 2 13.4 7 0 6.7-5.8 11.3-17 11.3s-13.4-4.7-13.4-9c0-1.8.2-3.5 1-5.8l-6.4-3C4.5 84.8.2 87 .2 92c0 6.8 7.5 11.3 25.8 11.3 21.2 0 29.6-8.5 29.6-20 0-14.4-12-17.2-23.8-17.2H21c-5.5 0-6.6-.4-6.6-1.4 0-1 1-2 4.6-4.4 2.2.4 5.4.8 8.5.8C40.3 61 49 55 49 43c0-6.8-4-10.5-8-13.3-.6-2.5-.8-4.6-.8-6.3 0-6.5 3-7 4.5-7 2.2 0 2.8 1.7 2.5 3.4l-3 1.8zM22 41.2C22 29.7 24 28 27 28s4.6 1.4 4.6 13.2v5c0 11-1.8 12.7-4.6 12.7-3.2 0-5-2.3-5-12V41zM62 10c0 4.4 2 9.8 10.6 9.8 7.6 0 10.6-4.3 10.6-10 0-6.3-3.8-9.6-10.4-9.6C65 .2 62 5 62 10zm-5.4 17v2h6.2v46H57v2h31.2v-2h-6V27H56.7zm82.5 0H95l-1.4 20.2H95c4.3-15 8-18.3 22.2-18.3h1L93 75.3V77h44l1.8-21.5h-1.5C133.5 69 127.5 75 115.6 75h-1.4l25-46v-2zm41 3c2.2 0 4.3 1 2.2 5.3h-3.8c-2.2 7.5 1 12 8.2 12 5.6 0 8.8-4 8.8-10 0-8-5-11.3-11.2-11.3-6.3 0-12 3.6-14 11V27H145v2h5.7v46h-5.8v2h32.6v-2h-7.4V47c0-9.5 4.7-17 9.7-17zm40.5 22.3c-15 0-24.2 2.4-24.2 13 0 10.5 8.2 12.8 15.6 12.8 7.2 0 10.3-2.7 12-7.7 1.2 5 6 7.8 14.4 7.8 9 0 13-3.5 13.5-16l-1.7-.2c-.5 8.8-2.3 10.8-4.2 10.8-1.7 0-3-1.2-3-5.5V46c0-15.2-5.5-19.8-22-19.8-14.3 0-22 4-22 13 0 5 2.6 8.6 9 8.6 5.3 0 9.3-3.3 9.3-8.2 0-2-.3-3.4-.8-4.7H214c-.6-1.2-.8-2.2-.8-3 0-3.4 3-4.3 5-4.3 4.2 0 5.3 3.5 5.3 16.8v8h-3zM219 73.8c-2 0-2.7-1-2.7-8.6v-1.6c0-6.4 2-9.6 6.5-9.6h.7v9.8c0 6.7-2.5 10-4.5 10z"/></svg></a><div class=tagline>We Build Websites</div></div><div class="five wide computer only column"></div></header><div class="ui grid centered post"><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column"><div class="ui raised padded segment"><h1 class="ui dividing header"><div class="ui image"><img src=/assets/images/team/avatars/amitaibu.jpg class="ui circular image"></div><div class=content><a href="/content/migrate-and-baking-content/">Migrate, and baking content</a><div class="sub header">By Amitai Burstein (@amitaibu) // 27 Dec 2012</div></div><div class="right floated column"><a href=/blog class="ui teal right ribbon big label">Blog Post</a></div></h1><p>A small problem in Drupal occurs when developing new modules, or installation profiles. Content. It goes missing, and without it developing can go wrong very quickly. Also, starting up a site’s install profile that reveals a site without content gives a feel of walking into an empty bakery shop. There’s ovens, flour, and bakers, and that great bakery smell all around, but no bread. And possible clients go to other bakeries if you run out of bread. So to solve this issue, <a href=http://drupal.org/project/migrate>Migrate</a> module helps us fill up the shop with bread. Oh, and you can also migrate data from other (older) sites.</p><h3>What is it good for?</h3><p>Migrate fills up your Drupal installation profile, or just fresh new module, with appropriate content that helps the user or developer experiment with it, so the new module’s learning curve is easier. When developing, if you mess something up - say, drop the user table - it won’t be as bad as it could’ve been, since you kept around a backup in a CSV file. Some company want their site upgraded? No problem. Migrate can import from CSV, SQL databases, XML and much more.</p><p>_For the less technical: if you think I’m just naming random letters, relax: if you have Microsoft Excel, or even OpenOffice (it’s free!), you can start creating content before you even have a site. Just open up a new table in either software, and save it as a CSV file. Your developer should be able to guide you through in a few minutes. If he can’t, well, you might want to consider a different one.</p><p>Migrate provides a strong advantage when developing installation profiles. When you rebuild a profile, the existing database is thrown away and replaced with a new one. But most of the time, you will need content to work with, test your logic, and see the resulting displayed page. With Migrate, when you install a profile, you can automatically import content to work with.</p><p>Also, Migrate is great for it’s obvious main purpose - to migrate sites’ content to a drupal installation. This is great if you’re building a site for a client that already has a working site but is looking for an upgrade and is afraid of losing all of the site’s content.</p><p>However, the best use of Migrate is during the initial development of a new site. Think of it like that: the bakery is still being built, but the baker can’t wait to start baking. He has all those little recipes he’s anxious to try, so in the meantime he prepares dough and keeps it in his household refrigerator. The same principle occurs with Migrate: while Dave, the developer, is building on the structure of the database, content types and whatnots, Sam, the site’s manager, can start creating content, and customize it’s structure according to his needs. All Sam needs to do is create a table and save it in some Migrate-able format (like a CSV file) . This saves time for Sam till he can launch the site, since he can start preparing the content – and put the dough straight in the oven from the refrigerator, without hassling around with flour and eggs. The site will have a quicker ‘cool down’ time between the development is finished until the site is actually launched, since the content is already stored and ready to be used.</p><p>Not only time is saved. Dave receives less stress from Sam while developing, since Sam is busy creating content for the new site. Confusion is reduced when Sam decides some content’s structure needs to be altered during development (which occurs quite often) to better suit his needs. A more finely defined content is created as a result, better suited to Sam’s needs, and with less last-minute fixes. A few lines of migration code and voila! Everything is ready for the newly structured content.</p><h3>So, how do I use Migrate?</h3><p>Data storage (a.k.a - Sam’s side of the story) The migrate module reads information stored in .csv files. An example of one of these is shown below:</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="http://www.gizra.com//assets/images/legacy/s025.png"/></div></div></div><p>Notice that ‘company’ and ‘status’ columns are filled with references to other entities’ IDs.</p><p>That’s it for site developers. Create a table, make sure everything sits the way you want it, and send it to the developer.</p><h4>The Drupal side: (a.k.a - Dave’s side of the story)</h4><p>If you’re reading this, I’m assuming you are a Drupal developer (it’s quite technical from now on). I’ve written a simplified example, divided into parts. In this example, I’ve shown how to migrate content from CSV files. A complete, working example of an abstract migration class can be found <a href=https://github.com/Gizra/Garment-Box/blob/7.x-1.x/garmentbox/modules/custom/garmentbox_migrate/includes/garmentbox_migrate.migrate.entity.inc>here</a> - and in the same git repository there is a complete implementation of a custom Migrate module. All the CSV files under under a csv direcrory using a naming convention <code class=highlighter-rouge>csv/entity_type/bundle.csv</code>. Example of using this abstract class to import taxonomy terms is shown below: &lt; img src=”http://www.gizra.com/sites/default/files/s033.png” /&gt;</p><div class="language-php highlighter-rouge"><pre class=highlight><code><span class=cp>&lt;?php</span>
<span class=sd>/**
 * Migrate measurement unit terms.
 *
 * Use garmentboxMigration class to import taxonomy terms.
 */</span>
<span class=k>class</span> <span class=nc>garmentboxMeasurementUnitTerms</span> <span class=k>extends</span> <span class=nx>garmentboxMigration</span> <span class=p>{</span>

  <span class=c1>// Define entity type and bundle, used in garmentboxMigration.
</span>  <span class=k>public</span> <span class=nv>$entityType</span> <span class=o>=</span> <span class=s1>'taxonomy_term'</span><span class=p>;</span>
  <span class=k>public</span> <span class=nv>$bundle</span> <span class=o>=</span> <span class=s1>'measurement_units'</span><span class=p>;</span>

  <span class=c1>// Map columns to import. garmentboxMigration already mapped "id" and
</span>  <span class=c1>// "name".
</span>  <span class=k>public</span> <span class=nv>$csvColumns</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
    <span class=s1>'field_unit_type'</span><span class=p>,</span>
    <span class=s1>'field_conversion_ratio'</span><span class=p>,</span>
  <span class=p>);</span>

  <span class=k>public</span> <span class=k>function</span> <span class=nf>__construct</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>parent</span><span class=o>::</span><span class=na>__construct</span><span class=p>();</span>
    <span class=c1>// Map the mapped columns to fields.
</span>    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>addFieldMapping</span><span class=p>(</span><span class=s1>'field_unit_type'</span><span class=p>,</span> <span class=s1>'field_unit_type'</span><span class=p>);</span>
    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>addFieldMapping</span><span class=p>(</span><span class=s1>'field_conversion_ratio'</span><span class=p>,</span> <span class=s1>'field_conversion_ratio'</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
<span class=cp>?&gt;</span>
</code></pre></div><p>And that’s it. <code class=highlighter-rouge>garmentboxMigration</code> takes care of stitching everything together, and putting the data in the content’s fields. You can obviously extend this abstract class to fit your own business logic. Importing files and images is also easy:</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="http://www.gizra.com//assets/images/legacy/s029.png"/></div></div></div><div class="language-php highlighter-rouge"><pre class=highlight><code><span class=cp>&lt;?php</span>
<span class=nv>$this</span><span class=o>-&gt;</span><span class=na>addFieldMapping</span><span class=p>(</span><span class=s1>'field_image'</span><span class=p>,</span> <span class=s1>'field_image'</span><span class=p>);</span>
<span class=nv>$this</span>
  <span class=o>-&gt;</span><span class=na>addFieldMapping</span><span class=p>(</span><span class=s1>'field_image:file_replace'</span><span class=p>)</span>
  <span class=o>-&gt;</span><span class=na>defaultValue</span><span class=p>(</span><span class=nx>FILE_EXISTS_REPLACE</span><span class=p>);</span>
<span class=nv>$this</span>
  <span class=o>-&gt;</span><span class=na>addFieldMapping</span><span class=p>(</span><span class=s1>'field_image:source_dir'</span><span class=p>)</span>
  <span class=o>-&gt;</span><span class=na>defaultValue</span><span class=p>(</span><span class=nx>drupal_get_path</span><span class=p>(</span><span class=s1>'module'</span><span class=p>,</span> <span class=s1>'example_migrate'</span><span class=p>)</span> <span class=o>.</span> <span class=s1>'/images'</span><span class=p>);</span>
<span class=cp>?&gt;</span>
</code></pre></div><p>For multiple values in one field, use the separator(‘|’) function when defining field mapping:</p><div class="ui segments"><div class="ui attached center aligned segment"><div class="ui image"><img src="http://www.gizra.com//assets/images/legacy/s028.png"/></div></div></div><div class="language-php highlighter-rouge"><pre class=highlight><code><span class=cp>&lt;?php</span>
<span class=nv>$this</span>
  <span class=o>-&gt;</span><span class=na>addFieldMapping</span><span class=p>(</span><span class=s1>'field_inventory_line_inline'</span><span class=p>,</span> <span class=s1>'field_inventory_line_inline'</span><span class=p>)</span>
  <span class=o>-&gt;</span><span class=na>sourceMigration</span><span class=p>(</span><span class=s1>'exampleInventoryLines'</span><span class=p>)</span>
  <span class=o>-&gt;</span><span class=na>separator</span><span class=p>(</span><span class=s1>'|'</span><span class=p>);</span>
<span class=cp>?&gt;</span>
</code></pre></div><p>For additional data tweaking, we can use the <code class=highlighter-rouge>prepare()</code>, <code class=highlighter-rouge>prepareRow()</code>, and <code class=highlighter-rouge>complete()</code> functions.</p><div class="language-php highlighter-rouge"><pre class=highlight><code><span class=cp>&lt;?php</span>
<span class=k>public</span> <span class=k>function</span> <span class=nf>complete</span><span class=p>(</span><span class=nv>$entity</span><span class=p>,</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
  <span class=c1>// Do something, e.g. flag a flag on the node.
</span><span class=p>}</span>
<span class=cp>?&gt;</span>
</code></pre></div><p>After everything is built, we stroll over to the UI (admin/content/migrate) and select what we want to import, and import away. Alternatively, Migrate can run through drush, which you’ll probably want to use when using an installation profile.</p></div></div><div class="twelve wide column computer only"><div class="ui borderless secondary menu"><a class=item href="/content/drupal-nodejs-pantheon-and-heroku/"><i class="chevron left icon"></i> Drupal, Node.js, Pantheon, and Heroku</a><div class="right menu"><a class=item href="/content/harvard-openscholar/">Harvard's OpenScholar <i class="chevron right icon"></i></a></div></div></div><div class="twelve wide column"><div class="ui segment basic"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname = 'gizra';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></div></div></div><footer class="ui black inverted vertical footer segment padded"><div class="ui center aligned container"><div class="ui three column stackable inverted grid"><div class=column><address><div class=strong>Israel Headquarters</div><div>5 Brenner Street, Tel Aviv</div><a class=telephone href=tel:+97233731222>+972-3-3731222</a> // <a class=email href=mailto:info@gizra.com>info@gizra.com</a></address></div><div class="column icons"><a target=_blank href=https://twitter.com/gizra_drupal><i class="twitter huge icon"></i></a> <a target=_blank href=https://github.com/Gizra/gizra.com><i class="github huge icon"></i></a></div><div class=column><address><div class=strong>North America Office</div><div>350 N. Orleans Street, Suite 9000N, Chicago, IL 60647</div><a class=telephone href=tel:+13125857625>312-585-7625</a> // <a class=email href=mailto:usoffice@gizra.com>usoffice@gizra.com</a></address></div></div></div></footer></div><script src=/bower_components/anchor-js/anchor.min.js></script><script src=/assets/javascript/script.js></script></body></html>